<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ… ç•ªèŒ„ç‹å›½ - ç¤¾äº¤äº’åŠ¨ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #FEFBF5;
            background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,.02) 2px, rgba(0,0,0,.02) 4px);
            min-height: 100vh;
            padding-bottom: 60px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: #FF6347;
            color: white;
        }

        .btn-secondary {
            background: #4CAF50;
            color: white;
        }

        .btn-outline {
            background: white;
            color: #FF6347;
            border: 2px solid #FF6347;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* åº•éƒ¨å¯¼èˆªæ  */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item:hover {
            background: #f9f9f9;
        }

        .nav-item.active {
            color: #FF6347;
        }

        .nav-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 12px;
        }

        /* ç…§ç‰‡ä¸Šä¼ åŒºåŸŸ */
        .photo-upload-btn {
            width: 100%;
            padding: 48px;
            border: 3px dashed #FF6347;
            border-radius: 16px;
            background: linear-gradient(135deg, #FFF4E6, #FFE4E1);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .photo-upload-btn:hover {
            background: linear-gradient(135deg, #FFE4E1, #FFF4E6);
            transform: scale(1.02);
        }

        .camera-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* ç…§ç‰‡å¡ç‰‡ */
        .photo-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .photo-card-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FF6347, #FF4500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .post-time {
            font-size: 12px;
            color: #999;
        }

        .photo-card-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            cursor: pointer;
        }

        .photo-card-content {
            padding: 16px;
        }

        .photo-description {
            margin-bottom: 12px;
            line-height: 1.6;
            color: #333;
        }

        .photo-meta {
            display: flex;
            gap: 16px;
            color: #666;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .photo-actions {
            display: flex;
            gap: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            background: #f9f9f9;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #f0f0f0;
        }

        .action-btn.liked {
            color: #FF6347;
            background: #FFF4E6;
        }

        /* è¯„è®ºåŒº */
        .comments-section {
            padding: 16px;
            background: #f9f9f9;
            border-top: 1px solid #f0f0f0;
        }

        .comment {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .comment:last-child {
            border-bottom: none;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .comment-avatar {
            width: 24px;
            height: 24px;
            background: #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .comment-name {
            font-weight: bold;
            font-size: 14px;
        }

        .comment-time {
            font-size: 12px;
            color: #999;
            margin-left: auto;
        }

        .comment-text {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .comment-input-area {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .comment-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
        }

        .comment-input:focus {
            outline: none;
            border-color: #FF6347;
        }

        /* è§‚å¯Ÿç¬”è®°æç¤º */
        .note-prompts {
            background: #E0F2FE;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .note-prompt-title {
            font-weight: bold;
            color: #0369a1;
            margin-bottom: 8px;
        }

        .note-prompt-item {
            padding: 6px 0;
            color: #075985;
            font-size: 14px;
        }

        .note-prompt-item::before {
            content: "ğŸ’¡ ";
        }

        /* æ•™å¸ˆè¯„è¯­ */
        .teacher-comment {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-left: 4px solid #F59E0B;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }

        .teacher-comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .teacher-badge {
            background: #F59E0B;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .teacher-comment-text {
            color: #92400E;
            line-height: 1.6;
        }

        /* ç…§ç‰‡ç½‘æ ¼ */
        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .grid-photo {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .grid-photo:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        .grid-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .grid-photo-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            padding: 8px;
            font-size: 12px;
        }

        /* ç¯ç®± */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .lightbox-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 12px;
        }

        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 36px;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* å…¶ä»–æ ·å¼ */
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            margin-top: 8px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #FF6347;
        }

        .hero {
            text-align: center;
            margin: 40px 0;
        }

        .hero h1 {
            font-size: 36px;
            color: #FF6347;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 28px;
            }
            
            .photos-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: #999;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-item {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-item:hover {
            background: #f9f9f9;
        }

        .tab-item.active {
            color: #FF6347;
            border-bottom-color: #FF6347;
        }

        .badge {
            display: inline-block;
            background: #FF6347;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 6px;
        }

        /* ç”Ÿé•¿æ—¶é—´è½´æ ·å¼ */
        .photo-timeline {
            position: relative;
            padding-left: 40px;
            margin: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #FF6347, #4CAF50);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 32px;
        }

        .timeline-dot {
            position: absolute;
            left: -27px;
            top: 8px;
            width: 16px;
            height: 16px;
            background: #FF6347;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .timeline-content {
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .timeline-date {
            font-weight: bold;
            color: #FF6347;
            margin-bottom: 8px;
        }

        .timeline-photo {
            width: 100%;
            max-width: 300px;
            border-radius: 8px;
            margin-top: 12px;
            cursor: pointer;
        }

        /* ç”µå­ä¹¦é¢„è§ˆæ ·å¼ */
        .ebook-preview {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .ebook-cover {
            text-align: center;
            padding: 48px 24px;
            background: linear-gradient(135deg, #FF6347, #FFE4E1);
            border-radius: 12px;
            color: white;
            margin-bottom: 32px;
        }

        .ebook-page {
            page-break-after: always;
            margin-bottom: 32px;
            padding: 24px;
            border: 1px solid #f0f0f0;
            border-radius: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¦–é¡µ -->
        <div id="landing" class="page active">
            <div class="hero">
                <h1>ğŸ… ç•ªèŒ„ç‹å›½</h1>
                <p style="font-size: 18px; color: #666;">è®°å½•æˆé•¿ï¼Œåˆ†äº«å‘ç°ï¼Œä¸€èµ·è®¨è®º</p>
            </div>

            <div class="card" style="text-align: center;">
                <p style="font-size: 18px; margin-bottom: 24px;">è¯·é€‰æ‹©ä½ çš„èº«ä»½</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                    <button class="btn btn-primary" onclick="loginAsStudent()" style="padding: 32px; font-size: 18px;">
                        <div style="font-size: 48px; margin-bottom: 8px;">ğŸ“±</div>
                        å­¦ç”Ÿç«¯
                    </button>
                    <button class="btn btn-secondary" onclick="loginAsTeacher()" style="padding: 32px; font-size: 18px;">
                        <div style="font-size: 48px; margin-bottom: 8px;">ğŸ‘¨â€ğŸ«</div>
                        æ•™å¸ˆç«¯
                    </button>
                </div>
            </div>
        </div>

        <!-- æ‹ç…§è®°å½•é¡µé¢ -->
        <div id="photo-capture" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ“¸ æ‹ç…§è®°å½•æˆé•¿</h2>
                
                <form onsubmit="savePhotoPost(event)">
                    <div style="margin-bottom: 24px;">
                        <label style="font-weight: bold; font-size: 18px; display: block; margin-bottom: 12px;">
                            ğŸ“· æ‹æ‘„ç…§ç‰‡
                        </label>
                        <input type="file" accept="image/*" capture="environment" id="photoInput" style="display: none;" onchange="handlePhotoSelect(event)">
                        <div class="photo-upload-btn" onclick="document.getElementById('photoInput').click()">
                            <div class="camera-icon">ğŸ“·</div>
                            <p style="font-size: 18px; font-weight: bold; color: #FF6347; margin-bottom: 8px;">
                                ç‚¹å‡»æ‹ç…§
                            </p>
                            <p style="color: #666; font-size: 14px;">
                                è®°å½•ç•ªèŒ„ä»Šå¤©çš„æ ·å­
                            </p>
                        </div>
                        <div id="photoPreview" style="margin-top: 16px;"></div>
                    </div>

                    <div class="note-prompts">
                        <div class="note-prompt-title">ğŸ“ è§‚å¯Ÿç¬”è®°å¼•å¯¼ï¼ˆè¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼‰</div>
                        <div class="note-prompt-item">ä»Šå¤©ç•ªèŒ„æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ</div>
                        <div class="note-prompt-item">æˆ‘è§‚å¯Ÿåˆ°äº†ä»€ä¹ˆæ–°å‘ç°ï¼Ÿ</div>
                        <div class="note-prompt-item">æˆ‘åšäº†ä»€ä¹ˆç…§é¡¾å·¥ä½œï¼Ÿ</div>
                        <div class="note-prompt-item">æˆ‘æœ‰ä»€ä¹ˆç–‘é—®æˆ–æƒ³æ³•ï¼Ÿ</div>
                    </div>

                    <div style="margin-bottom: 24px;">
                        <label style="font-weight: bold; font-size: 18px;">ğŸ“ æˆ‘çš„è§‚å¯Ÿç¬”è®°</label>
                        <textarea id="noteInput" rows="6" placeholder="è¯·æ ¹æ®ä¸Šé¢çš„é—®é¢˜ï¼Œå†™ä¸‹ä½ çš„è§‚å¯Ÿ...&#10;&#10;ä¾‹å¦‚ï¼š&#10;ä»Šå¤©ç•ªèŒ„é•¿é«˜äº†2å˜ç±³ï¼Œæˆ‘å‘ç°...&#10;æˆ‘ç»™å®ƒæµ‡äº†æ°´ï¼Œè¿˜...&#10;æˆ‘æƒ³çŸ¥é“ä¸ºä»€ä¹ˆ..." required></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <button type="button" class="btn btn-outline" onclick="showPage('my-photos')">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ğŸ“¤ å‘å¸ƒ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- æˆ‘çš„ç•ªèŒ„ -->
        <div id="my-photos" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 8px;">ğŸŒ± æˆ‘çš„ç•ªèŒ„</h2>
                <p style="color: #666; margin-bottom: 24px;">æˆ‘æ‹æ‘„çš„æˆé•¿è®°å½•</p>
                
                <div id="myPhotosList"></div>
            </div>
        </div>

        <!-- ç­çº§ç…§ç‰‡å¢™ -->
        <div id="class-wall" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ–¼ï¸ ç­çº§ç…§ç‰‡å¢™</h2>
                
                <div class="tab-nav">
                    <div class="tab-item active" onclick="filterPhotos('all')">å…¨éƒ¨</div>
                    <div class="tab-item" onclick="filterPhotos('recent')">æœ€æ–°</div>
                    <div class="tab-item" onclick="filterPhotos('popular')">çƒ­é—¨</div>
                </div>

                <div id="classPhotosList"></div>
            </div>
        </div>

        <!-- è®¨è®ºåŒº -->
        <div id="discussion" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ’¬ è®¨è®ºåŒº</h2>
                
                <div id="discussionList"></div>
            </div>
        </div>

        <!-- ç”Ÿé•¿æ—¶é—´è½´ -->
        <div id="timeline" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 8px;">ğŸ“… æˆ‘çš„ç”Ÿé•¿æ—¶é—´è½´</h2>
                <p style="color: #666; margin-bottom: 24px;">æŸ¥çœ‹ç•ªèŒ„çš„æ¯ä¸€å¤©</p>
                
                <div id="timelineContent" class="photo-timeline">
                    <div class="timeline-line"></div>
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“…</div>
                        <p>è¿˜æ²¡æœ‰è®°å½•</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç”µå­ä¹¦ç”Ÿæˆ -->
        <div id="ebook" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ“– ç”Ÿæˆæˆé•¿ç”µå­ä¹¦</h2>
                
                <div style="margin-bottom: 24px; text-align: center;">
                    <button class="btn btn-primary" onclick="generateEbook()" style="margin-right: 12px;">
                        ğŸ“š ç”Ÿæˆæˆ‘çš„ç”µå­ä¹¦
                    </button>
                    <button class="btn btn-secondary" onclick="downloadEbook()" id="downloadEbookBtn" style="display: none;">
                        ğŸ’¾ ä¸‹è½½ç”µå­ä¹¦
                    </button>
                </div>

                <div id="ebookPreview"></div>
            </div>
        </div>

        <!-- æ•™å¸ˆç«¯ -->
        <div id="teacher-panel" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ‘¨â€ğŸ« æ•™å¸ˆç®¡ç†</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px;">
                    <div class="card" style="background: linear-gradient(135deg, #DBEAFE, #BFDBFE); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“¸</div>
                        <div style="font-size: 28px; font-weight: bold; color: #1e40af;" id="teacherTotalPhotos">0</div>
                        <div style="font-size: 14px; color: #666;">æ€»ç…§ç‰‡æ•°</div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #D1FAE5, #A7F3D0); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ‘¥</div>
                        <div style="font-size: 28px; font-weight: bold; color: #065f46;" id="teacherActiveStudents">0</div>
                        <div style="font-size: 14px; color: #666;">æ´»è·ƒå­¦ç”Ÿ</div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ’¬</div>
                        <div style="font-size: 28px; font-weight: bold; color: #92400e;" id="teacherTotalComments">0</div>
                        <div style="font-size: 14px; color: #666;">æ€»è¯„è®ºæ•°</div>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <button class="btn btn-primary" onclick="exportAllData()" style="width: 100%;">
                        ğŸ’¾ ä¸€é”®å¯¼å‡ºæ‰€æœ‰è®°å½•
                    </button>
                </div>

                <h3 style="margin-bottom: 16px;">å­¦ç”Ÿç…§ç‰‡åˆ—è¡¨</h3>
                <div id="teacherPhotosList"></div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <div class="nav-item active" onclick="showPage('my-photos')">
            <span class="nav-icon">ğŸŒ±</span>
            <span class="nav-label">æˆ‘çš„ç•ªèŒ„</span>
        </div>
        <div class="nav-item" onclick="showPage('photo-capture')">
            <span class="nav-icon">ğŸ“¸</span>
            <span class="nav-label">æ‹ç…§</span>
        </div>
        <div class="nav-item" onclick="showPage('timeline')">
            <span class="nav-icon">ğŸ“…</span>
            <span class="nav-label">æ—¶é—´è½´</span>
        </div>
        <div class="nav-item" onclick="showPage('class-wall')">
            <span class="nav-icon">ğŸ–¼ï¸</span>
            <span class="nav-label">ç…§ç‰‡å¢™</span>
        </div>
        <div class="nav-item" onclick="showPage('ebook')">
            <span class="nav-icon">ğŸ“–</span>
            <span class="nav-label">ç”µå­ä¹¦</span>
        </div>
    </div>

    <!-- ç…§ç‰‡ç¯ç®± -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <div class="lightbox-content" onclick="event.stopPropagation()">
            <div class="lightbox-close" onclick="closeLightbox()">Ã—</div>
            <img class="lightbox-image" id="lightboxImage" src="" alt="">
        </div>
    </div>

    <script>
        // æ•°æ®æ¨¡å‹
        let appData = {
            currentUser: null,
            photos: [],
            comments: [],
            students: [
                { id: 1, name: 'å°æ˜', avatar: 'ğŸ‘¦' },
                { id: 2, name: 'å°çº¢', avatar: 'ğŸ‘§' },
                { id: 3, name: 'å°åˆš', avatar: 'ğŸ‘¨' },
                { id: 4, name: 'å°ç¾', avatar: 'ğŸ‘©' },
            ],
            currentPhoto: null
        };

        // åˆå§‹åŒ–
        function init() {
            loadFromLocalStorage();
            generateSampleData();
        }

        // ç”Ÿæˆç¤ºä¾‹æ•°æ®
        function generateSampleData() {
            if (appData.photos.length === 0) {
                const now = Date.now();
                for (let i = 0; i < 6; i++) {
                    const studentId = (i % 4) + 1;
                    appData.photos.push({
                        id: Date.now() + i,
                        studentId: studentId,
                        photo: `data:image/svg+xml;base64,${btoa(`<svg width="400" height="400" xmlns="http://www.w3.org/2000/svg"><rect width="400" height="400" fill="#${['FFE4E1', 'E0F2FE', 'D1FAE5', 'FEF3C7'][i % 4]}"/><text x="50%" y="45%" font-size="80" text-anchor="middle" dy=".3em">ğŸ…</text><text x="50%" y="65%" font-size="20" text-anchor="middle" fill="#666">ç¬¬${i + 1}å¤©</text></svg>`)}`,
                        note: `ä»Šå¤©ç•ªèŒ„é•¿é«˜äº†ä¸€ç‚¹ï¼Œæˆ‘è§‚å¯Ÿåˆ°${['å¶ç‰‡æ›´ç»¿äº†', 'å¼€äº†å°èŠ±', 'ç»“äº†æœå®', 'èŒå˜ç²—äº†'][i % 4]}ã€‚æˆ‘ç»™å®ƒæµ‡äº†æ°´ï¼Œå¸Œæœ›å®ƒèƒ½å¥åº·æˆé•¿ï¼`,
                        timestamp: now - (6 - i) * 24 * 60 * 60 * 1000,
                        likes: Math.floor(Math.random() * 10),
                        likedBy: []
                    });
                }
            }
        }

        // LocalStorage
        function saveToLocalStorage() {
            localStorage.setItem('tomatoSocial', JSON.stringify(appData));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('tomatoSocial');
            if (saved) {
                appData = { ...appData, ...JSON.parse(saved) };
            }
        }

        // ç™»å½•
        function loginAsStudent() {
            const studentId = prompt('è¯·è¾“å…¥ä½ çš„å­¦å·ï¼ˆ1-4ï¼‰ï¼š');
            if (studentId && studentId >= 1 && studentId <= 4) {
                appData.currentUser = {
                    id: parseInt(studentId),
                    role: 'student',
                    ...appData.students[studentId - 1]
                };
                document.getElementById('bottomNav').style.display = 'flex';
                showPage('my-photos');
            }
        }

        function loginAsTeacher() {
            appData.currentUser = {
                id: 999,
                role: 'teacher',
                name: 'ç‹è€å¸ˆ',
                avatar: 'ğŸ‘¨â€ğŸ«'
            };
            showPage('teacher-panel');
            loadTeacherPanel();
        }

        // é¡µé¢å¯¼èˆª
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event?.target?.closest('.nav-item')?.classList.add('active');

            // åŠ è½½å¯¹åº”é¡µé¢å†…å®¹
            if (pageId === 'my-photos') loadMyPhotos();
            if (pageId === 'class-wall') loadClassWall();
            if (pageId === 'discussion') loadDiscussion();
            if (pageId === 'timeline') loadTimeline();
            if (pageId === 'ebook') {
                document.getElementById('ebookPreview').innerHTML = '';
                document.getElementById('downloadEbookBtn').style.display = 'none';
            }
            
            window.scrollTo(0, 0);
        }

        // å¤„ç†ç…§ç‰‡é€‰æ‹©
        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                appData.currentPhoto = e.target.result;
                document.getElementById('photoPreview').innerHTML = `
                    <img src="${e.target.result}" style="max-width: 100%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                `;
            };
            reader.readAsDataURL(file);
        }

        // ä¿å­˜ç…§ç‰‡å‘å¸ƒ
        function savePhotoPost(e) {
            e.preventDefault();
            
            if (!appData.currentPhoto) {
                alert('è¯·å…ˆæ‹ç…§ï¼');
                return;
            }

            const note = document.getElementById('noteInput').value;
            
            const newPhoto = {
                id: Date.now(),
                studentId: appData.currentUser.id,
                photo: appData.currentPhoto,
                note: note,
                timestamp: Date.now(),
                likes: 0,
                likedBy: []
            };

            appData.photos.unshift(newPhoto);
            saveToLocalStorage();

            alert('âœ… å‘å¸ƒæˆåŠŸï¼');
            
            // é‡ç½®è¡¨å•
            document.getElementById('noteInput').value = '';
            document.getElementById('photoPreview').innerHTML = '';
            appData.currentPhoto = null;
            document.getElementById('photoInput').value = '';
            
            showPage('my-photos');
        }

        // åŠ è½½æˆ‘çš„ç…§ç‰‡
        function loadMyPhotos() {
            const myPhotos = appData.photos.filter(p => p.studentId === appData.currentUser.id);
            const container = document.getElementById('myPhotosList');
            
            if (myPhotos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“·</div>
                        <p>è¿˜æ²¡æœ‰ç…§ç‰‡è®°å½•</p>
                        <button class="btn btn-primary" onclick="showPage('photo-capture')" style="margin-top: 16px;">
                            ç«‹å³æ‹ç…§
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = myPhotos.map(photo => createPhotoCard(photo, true)).join('');
        }

        // åŠ è½½ç­çº§ç…§ç‰‡å¢™
        function loadClassWall() {
            const container = document.getElementById('classPhotosList');
            container.innerHTML = appData.photos.map(photo => createPhotoCard(photo, false)).join('');
        }

        // åˆ›å»ºç…§ç‰‡å¡ç‰‡
        function createPhotoCard(photo, isOwner) {
            const student = appData.students.find(s => s.id === photo.studentId);
            const isLiked = photo.likedBy?.includes(appData.currentUser.id);
            const comments = appData.comments?.filter(c => c.photoId === photo.id) || [];
            const teacherComment = comments.find(c => c.isTeacher);

            return `
                <div class="photo-card">
                    <div class="photo-card-header">
                        <div class="avatar">${student.avatar}</div>
                        <div class="user-info">
                            <div class="user-name">${student.name}</div>
                            <div class="post-time">${formatTime(photo.timestamp)}</div>
                        </div>
                    </div>
                    
                    <img src="${photo.photo}" class="photo-card-image" onclick="openLightbox('${photo.photo}')">
                    
                    <div class="photo-card-content">
                        <div class="photo-description">${photo.note}</div>
                        
                        <div class="photo-meta">
                            <span>â¤ï¸ ${photo.likes} ä¸ªèµ</span>
                            <span>ğŸ’¬ ${comments.length} æ¡è¯„è®º</span>
                        </div>

                        <div class="photo-actions">
                            <button class="action-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike(${photo.id})">
                                â¤ï¸ ${isLiked ? 'å·²èµ' : 'ç‚¹èµ'}
                            </button>
                            <button class="action-btn" onclick="toggleComments(${photo.id})">
                                ğŸ’¬ è¯„è®º
                            </button>
                        </div>
                    </div>

                    ${teacherComment ? `
                        <div class="teacher-comment">
                            <div class="teacher-comment-header">
                                <span class="teacher-badge">æ•™å¸ˆè¯„è¯­</span>
                                <span style="font-size: 14px; color: #92400E;">${formatTime(teacherComment.timestamp)}</span>
                            </div>
                            <div class="teacher-comment-text">${teacherComment.text}</div>
                        </div>
                    ` : ''}

                    <div class="comments-section" id="comments-${photo.id}" style="display: none;">
                        <div id="comment-list-${photo.id}">
                            ${comments.filter(c => !c.isTeacher).map(c => createCommentHTML(c)).join('')}
                        </div>
                        <div class="comment-input-area">
                            <input type="text" class="comment-input" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." id="comment-input-${photo.id}">
                            <button class="btn btn-small btn-primary" onclick="postComment(${photo.id})">å‘é€</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // åˆ›å»ºè¯„è®ºHTML
        function createCommentHTML(comment) {
            const user = comment.isTeacher ? 
                appData.currentUser : 
                appData.students.find(s => s.id === comment.userId);
            
            return `
                <div class="comment">
                    <div class="comment-header">
                        <div class="comment-avatar">${user.avatar}</div>
                        <div class="comment-name">${user.name}</div>
                        <div class="comment-time">${formatTime(comment.timestamp)}</div>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                </div>
            `;
        }

        // åˆ‡æ¢ç‚¹èµ
        function toggleLike(photoId) {
            const photo = appData.photos.find(p => p.id === photoId);
            if (!photo.likedBy) photo.likedBy = [];
            
            const index = photo.likedBy.indexOf(appData.currentUser.id);
            if (index > -1) {
                photo.likedBy.splice(index, 1);
                photo.likes--;
            } else {
                photo.likedBy.push(appData.currentUser.id);
                photo.likes++;
            }
            
            saveToLocalStorage();
            loadClassWall();
            loadMyPhotos();
        }

        // åˆ‡æ¢è¯„è®ºåŒº
        function toggleComments(photoId) {
            const section = document.getElementById(`comments-${photoId}`);
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        // å‘å¸ƒè¯„è®º
        function postComment(photoId) {
            const input = document.getElementById(`comment-input-${photoId}`);
            const text = input.value.trim();
            
            if (!text) return;

            if (!appData.comments) appData.comments = [];
            
            appData.comments.push({
                id: Date.now(),
                photoId: photoId,
                userId: appData.currentUser.id,
                text: text,
                timestamp: Date.now(),
                isTeacher: appData.currentUser.role === 'teacher'
            });

            saveToLocalStorage();
            input.value = '';
            
            // é‡æ–°åŠ è½½å½“å‰é¡µé¢
            if (document.getElementById('class-wall').classList.contains('active')) {
                loadClassWall();
            } else {
                loadMyPhotos();
            }
        }

        // åŠ è½½è®¨è®ºåŒº
        function loadDiscussion() {
            const container = document.getElementById('discussionList');
            const photosWithComments = appData.photos.filter(p => {
                const comments = appData.comments?.filter(c => c.photoId === p.id) || [];
                return comments.length > 0;
            });

            if (photosWithComments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ’¬</div>
                        <p>è¿˜æ²¡æœ‰è®¨è®º</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = photosWithComments.map(photo => createPhotoCard(photo, false)).join('');
        }

        // æ•™å¸ˆç«¯
        function loadTeacherPanel() {
            document.getElementById('teacherTotalPhotos').textContent = appData.photos.length;
            
            const activeStudents = new Set(appData.photos.map(p => p.studentId)).size;
            document.getElementById('teacherActiveStudents').textContent = activeStudents;
            
            document.getElementById('teacherTotalComments').textContent = appData.comments?.length || 0;

            const container = document.getElementById('teacherPhotosList');
            container.innerHTML = appData.photos.map(photo => {
                const student = appData.students.find(s => s.id === photo.studentId);
                return `
                    <div class="card" style="margin-bottom: 16px;">
                        <div style="display: flex; gap: 16px; align-items: center;">
                            <img src="${photo.photo}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 12px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; margin-bottom: 4px;">${student.name} - ${formatTime(photo.timestamp)}</div>
                                <div style="font-size: 14px; color: #666; margin-bottom: 8px;">${photo.note.substring(0, 50)}...</div>
                                <button class="btn btn-small btn-secondary" onclick="writeTeacherComment(${photo.id})">
                                    âœï¸ å†™è¯„è¯­
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ•™å¸ˆå†™è¯„è¯­
        function writeTeacherComment(photoId) {
            const comment = prompt('è¯·è¾“å…¥è¯„è¯­ï¼š');
            if (!comment) return;

            if (!appData.comments) appData.comments = [];
            
            appData.comments.push({
                id: Date.now(),
                photoId: photoId,
                userId: appData.currentUser.id,
                text: comment,
                timestamp: Date.now(),
                isTeacher: true
            });

            saveToLocalStorage();
            alert('âœ… è¯„è¯­å·²å‘å¸ƒï¼');
            loadTeacherPanel();
        }

        // å¯¼å‡ºæ‰€æœ‰æ•°æ®
        function exportAllData() {
            let exportText = 'ç•ªèŒ„ç‹å›½ - å®Œæ•´è®°å½•å¯¼å‡º\n';
            exportText += '================================\n\n';
            
            appData.students.forEach(student => {
                const photos = appData.photos.filter(p => p.studentId === student.id);
                if (photos.length === 0) return;

                exportText += `\nã€${student.name}ã€‘çš„è®°å½•\n`;
                exportText += `æ€»ç…§ç‰‡æ•°ï¼š${photos.length}\n\n`;

                photos.forEach((photo, index) => {
                    exportText += `ç¬¬${index + 1}å¼ ç…§ç‰‡ï¼ˆ${formatTime(photo.timestamp)}ï¼‰\n`;
                    exportText += `è§‚å¯Ÿç¬”è®°ï¼š${photo.note}\n`;
                    exportText += `ç‚¹èµæ•°ï¼š${photo.likes}\n`;
                    
                    const comments = appData.comments?.filter(c => c.photoId === photo.id) || [];
                    if (comments.length > 0) {
                        exportText += `è¯„è®ºï¼š\n`;
                        comments.forEach(c => {
                            const commenter = c.isTeacher ? 'æ•™å¸ˆ' : appData.students.find(s => s.id === c.userId).name;
                            exportText += `  - ${commenter}ï¼š${c.text}\n`;
                        });
                    }
                    exportText += '\n';
                });

                exportText += '--------------------------------\n';
            });

            // ä¸‹è½½ä¸ºæ–‡æœ¬æ–‡ä»¶
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ç•ªèŒ„ç‹å›½è®°å½•_${new Date().toLocaleDateString()}.txt`;
            a.click();
            
            alert('âœ… å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¸‹è½½ã€‚');
        }

        // è¿‡æ»¤ç…§ç‰‡
        function filterPhotos(type) {
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            let filtered = [...appData.photos];
            if (type === 'recent') {
                filtered.sort((a, b) => b.timestamp - a.timestamp);
            } else if (type === 'popular') {
                filtered.sort((a, b) => b.likes - a.likes);
            }
            
            document.getElementById('classPhotosList').innerHTML = 
                filtered.map(photo => createPhotoCard(photo, false)).join('');
        }

        // ç¯ç®±
        function openLightbox(photoSrc) {
            document.getElementById('lightboxImage').src = photoSrc;
            document.getElementById('lightbox').classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        // åŠ è½½ç”Ÿé•¿æ—¶é—´è½´
        function loadTimeline() {
            const myPhotos = appData.photos.filter(p => p.studentId === appData.currentUser.id);
            const container = document.getElementById('timelineContent');
            
            if (myPhotos.length === 0) {
                container.innerHTML = `
                    <div class="timeline-line"></div>
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“…</div>
                        <p>è¿˜æ²¡æœ‰è®°å½•</p>
                        <button class="btn btn-primary" onclick="showPage('photo-capture')" style="margin-top: 16px;">
                            ç«‹å³æ‹ç…§
                        </button>
                    </div>
                `;
                return;
            }

            // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°åœ¨ä¸Šï¼‰
            const sortedPhotos = [...myPhotos].sort((a, b) => b.timestamp - a.timestamp);
            
            container.innerHTML = `
                <div class="timeline-line"></div>
                ${sortedPhotos.map((photo, index) => `
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">
                                ${new Date(photo.timestamp).toLocaleDateString('zh-CN', {year: 'numeric', month: 'long', day: 'numeric'})} 
                                (ç¬¬${myPhotos.length - index}å¤©)
                            </div>
                            <img src="${photo.photo}" class="timeline-photo" onclick="openLightbox('${photo.photo}')">
                            <div style="color: #666; margin-top: 12px; line-height: 1.6;">${photo.note}</div>
                            <div style="color: #999; font-size: 14px; margin-top: 8px;">
                                â¤ï¸ ${photo.likes} ä¸ªèµ Â· ğŸ’¬ ${(appData.comments?.filter(c => c.photoId === photo.id) || []).length} æ¡è¯„è®º
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        // ç”Ÿæˆç”µå­ä¹¦
        let ebookHTML = '';
        
        function generateEbook() {
            const myPhotos = appData.photos.filter(p => p.studentId === appData.currentUser.id);
            
            if (myPhotos.length === 0) {
                alert('è¿˜æ²¡æœ‰ç…§ç‰‡è®°å½•ï¼Œæ— æ³•ç”Ÿæˆç”µå­ä¹¦ï¼');
                return;
            }

            const student = appData.students.find(s => s.id === appData.currentUser.id);
            const sortedPhotos = [...myPhotos].sort((a, b) => a.timestamp - b.timestamp);
            
            // ç”Ÿæˆç”µå­ä¹¦HTML
            ebookHTML = `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${student.name}çš„ç•ªèŒ„æˆé•¿ç”µå­ä¹¦</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: #FEFBF5;
            padding: 20px;
            line-height: 1.8;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .cover {
            text-align: center;
            padding: 80px 40px;
            background: linear-gradient(135deg, #FF6347, #FFE4E1);
            border-radius: 16px;
            color: white;
            margin-bottom: 40px;
        }
        .cover h1 { font-size: 48px; margin-bottom: 20px; }
        .cover p { font-size: 24px; opacity: 0.9; }
        .page {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            page-break-after: always;
        }
        .page-title {
            font-size: 24px;
            color: #FF6347;
            margin-bottom: 16px;
            border-bottom: 3px solid #FF6347;
            padding-bottom: 8px;
        }
        .page-date {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .page-photo {
            width: 100%;
            max-width: 600px;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .page-note {
            font-size: 18px;
            color: #333;
            line-height: 2;
            margin-top: 20px;
            padding: 20px;
            background: #FFF4E6;
            border-radius: 12px;
            border-left: 4px solid #FF6347;
        }
        .comments {
            margin-top: 24px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
        }
        .comment {
            margin: 12px 0;
            padding: 12px;
            background: white;
            border-radius: 8px;
        }
        .comment-author {
            font-weight: bold;
            color: #FF6347;
            margin-bottom: 4px;
        }
        .teacher-comment {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-left: 4px solid #F59E0B;
            padding: 16px;
            margin-top: 20px;
            border-radius: 8px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 16px;
            color: #666;
        }
        @media print {
            body { background: white; }
            .page { page-break-after: always; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="cover">
            <h1>ğŸ… æˆ‘çš„ç•ªèŒ„æˆé•¿ç”µå­ä¹¦</h1>
            <p>${student.name} çš„è‡ªç„¶è§‚å¯Ÿç¬”è®°</p>
            <p style="font-size: 18px; margin-top: 20px;">
                ${new Date(sortedPhotos[0].timestamp).toLocaleDateString('zh-CN')} - 
                ${new Date(sortedPhotos[sortedPhotos.length-1].timestamp).toLocaleDateString('zh-CN')}
            </p>
            <p style="font-size: 16px; margin-top: 10px;">å…± ${sortedPhotos.length} å¤©çš„è§‚å¯Ÿè®°å½•</p>
        </div>

        ${sortedPhotos.map((photo, index) => {
            const comments = appData.comments?.filter(c => c.photoId === photo.id) || [];
            const teacherComment = comments.find(c => c.isTeacher);
            const studentComments = comments.filter(c => !c.isTeacher);
            
            return `
        <div class="page">
            <div class="page-title">ç¬¬ ${index + 1} å¤©çš„è§‚å¯Ÿ</div>
            <div class="page-date">ğŸ“… ${new Date(photo.timestamp).toLocaleDateString('zh-CN', {year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'})}</div>
            
            <img src="${photo.photo}" class="page-photo" alt="ç¬¬${index+1}å¤©çš„ç•ªèŒ„">
            
            <div class="page-note">
                <strong>ğŸ“ è§‚å¯Ÿç¬”è®°ï¼š</strong><br>
                ${photo.note}
            </div>

            <div class="stats">
                <span>â¤ï¸ ${photo.likes} ä¸ªèµ</span>
                <span>ğŸ’¬ ${comments.length} æ¡è¯„è®º</span>
            </div>

            ${teacherComment ? `
                <div class="teacher-comment">
                    <div style="font-weight: bold; color: #92400E; margin-bottom: 8px;">
                        ğŸ‘¨â€ğŸ« æ•™å¸ˆè¯„è¯­ï¼š
                    </div>
                    ${teacherComment.text}
                </div>
            ` : ''}

            ${studentComments.length > 0 ? `
                <div class="comments">
                    <strong>ğŸ’¬ åŒå­¦è¯„è®ºï¼š</strong>
                    ${studentComments.map(c => {
                        const commenter = appData.students.find(s => s.id === c.userId);
                        return `
                        <div class="comment">
                            <div class="comment-author">${commenter?.name || 'å­¦ç”Ÿ'}:</div>
                            ${c.text}
                        </div>
                        `;
                    }).join('')}
                </div>
            ` : ''}
        </div>
            `;
        }).join('')}

        <div class="page" style="text-align: center; padding: 60px 40px;">
            <h2 style="color: #FF6347; font-size: 36px; margin-bottom: 20px;">ğŸ‰ æˆé•¿æ€»ç»“</h2>
            <p style="font-size: 20px; color: #666; line-height: 2;">
                åœ¨è¿™ ${sortedPhotos.length} å¤©çš„æ—¶é—´é‡Œï¼Œ<br>
                æˆ‘ä»¬ä¸€èµ·è§è¯äº†ç•ªèŒ„çš„æˆé•¿ã€‚<br><br>
                æ¯ä¸€å¤©çš„è§‚å¯Ÿå’Œè®°å½•ï¼Œ<br>
                éƒ½æ˜¯çè´µçš„å­¦ä¹ ç»å†ã€‚<br><br>
                æ„Ÿè°¢ä½ çš„åšæŒå’Œä»˜å‡ºï¼ğŸŒ±
            </p>
            <p style="margin-top: 40px; color: #999;">
                ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}
            </p>
        </div>
    </div>
</body>
</html>
            `;

            // æ˜¾ç¤ºé¢„è§ˆ
            document.getElementById('ebookPreview').innerHTML = `
                <div class="ebook-preview">
                    <div class="ebook-cover">
                        <h1 style="font-size: 36px; margin-bottom: 16px;">ğŸ… æˆ‘çš„ç•ªèŒ„æˆé•¿ç”µå­ä¹¦</h1>
                        <p style="font-size: 20px;">${student.name} çš„è‡ªç„¶è§‚å¯Ÿç¬”è®°</p>
                        <p style="margin-top: 16px; opacity: 0.9;">å…± ${sortedPhotos.length} å¤©çš„è§‚å¯Ÿè®°å½•</p>
                    </div>
                    <div style="text-align: center; padding: 24px; background: #E0F2FE; border-radius: 12px;">
                        <p style="font-size: 18px; color: #0369a1; margin-bottom: 12px;">âœ… ç”µå­ä¹¦å·²ç”Ÿæˆï¼</p>
                        <p style="color: #666;">ç‚¹å‡»ä¸Šæ–¹â€œä¸‹è½½ç”µå­ä¹¦â€æŒ‰é’®ä¿å­˜ä¸ºHTMLæ–‡ä»¶</p>
                    </div>
                </div>
            `;
            
            document.getElementById('downloadEbookBtn').style.display = 'inline-block';
            alert('âœ… ç”µå­ä¹¦ç”ŸæˆæˆåŠŸï¼ç‚¹å‡»ä¸‹è½½æŒ‰é’®ä¿å­˜ã€‚');
        }

        // ä¸‹è½½ç”µå­ä¹¦
        function downloadEbook() {
            if (!ebookHTML) {
                alert('è¯·å…ˆç”Ÿæˆç”µå­ä¹¦ï¼');
                return;
            }

            const student = appData.students.find(s => s.id === appData.currentUser.id);
            const blob = new Blob([ebookHTML], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${student.name}çš„ç•ªèŒ„æˆé•¿ç”µå­ä¹¦_${new Date().toLocaleDateString('zh-CN')}.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… ç”µå­ä¹¦å·²ä¸‹è½½ï¼åŒå‡»æ‰“å¼€HTMLæ–‡ä»¶å³å¯æŸ¥çœ‹ã€‚');
        }

        // å·¥å…·å‡½æ•°
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            if (diff < 604800000) return Math.floor(diff / 86400000) + 'å¤©å‰';
            
            return date.toLocaleDateString('zh-CN');
        }

        // åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
