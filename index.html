<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ… ç•ªèŒ„ç‹å›½ - å®Œæ•´ç‰ˆ</title>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #FEFBF5;
            background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,.02) 2px, rgba(0,0,0,.02) 4px);
            min-height: 100vh;
            padding-bottom: 60px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: #FF6347;
            color: white;
        }

        .btn-secondary {
            background: #4CAF50;
            color: white;
        }

        .btn-outline {
            background: white;
            color: #FF6347;
            border: 2px solid #FF6347;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* åº•éƒ¨å¯¼èˆªæ  */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item:hover {
            background: #f9f9f9;
        }

        .nav-item.active {
            color: #FF6347;
        }

        .nav-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 12px;
        }

        /* ç…§ç‰‡ä¸Šä¼ åŒºåŸŸ */
        .photo-upload-btn {
            width: 100%;
            padding: 48px;
            border: 3px dashed #FF6347;
            border-radius: 16px;
            background: linear-gradient(135deg, #FFF4E6, #FFE4E1);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .photo-upload-btn:hover {
            background: linear-gradient(135deg, #FFE4E1, #FFF4E6);
            transform: scale(1.02);
        }

        .camera-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* ç…§ç‰‡å¡ç‰‡ */
        .photo-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .photo-card-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FF6347, #FF4500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .post-time {
            font-size: 12px;
            color: #999;
        }

        .photo-card-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            cursor: pointer;
        }

        .photo-card-content {
            padding: 16px;
        }

        .photo-description {
            margin-bottom: 12px;
            line-height: 1.6;
            color: #333;
        }

        .photo-meta {
            display: flex;
            gap: 16px;
            color: #666;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .photo-actions {
            display: flex;
            gap: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            background: #f9f9f9;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #f0f0f0;
        }

        .action-btn.liked {
            color: #FF6347;
            background: #FFF4E6;
        }

        /* è¯„è®ºåŒº */
        .comments-section {
            padding: 16px;
            background: #f9f9f9;
            border-top: 1px solid #f0f0f0;
        }

        .comment {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .comment:last-child {
            border-bottom: none;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .comment-avatar {
            width: 24px;
            height: 24px;
            background: #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .comment-name {
            font-weight: bold;
            font-size: 14px;
        }

        .comment-time {
            font-size: 12px;
            color: #999;
            margin-left: auto;
        }

        .comment-text {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .comment-input-area {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .comment-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
        }

        .comment-input:focus {
            outline: none;
            border-color: #FF6347;
        }

        /* è§‚å¯Ÿç¬”è®°æç¤º */
        .note-prompts {
            background: #E0F2FE;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .note-prompt-title {
            font-weight: bold;
            color: #0369a1;
            margin-bottom: 8px;
        }

        .note-prompt-item {
            padding: 6px 0;
            color: #075985;
            font-size: 14px;
        }

        .note-prompt-item::before {
            content: "ğŸ’¡ ";
        }

        /* æ•™å¸ˆè¯„è¯­ */
        .teacher-comment {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-left: 4px solid #F59E0B;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }

        .teacher-comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .teacher-badge {
            background: #F59E0B;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .teacher-comment-text {
            color: #92400E;
            line-height: 1.6;
        }

        /* ç…§ç‰‡ç½‘æ ¼ */
        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .grid-photo {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .grid-photo:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        .grid-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .grid-photo-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            padding: 8px;
            font-size: 12px;
        }

        /* ç¯ç®± */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .lightbox-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 12px;
        }

        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 36px;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* å…¶ä»–æ ·å¼ */
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            margin-top: 8px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #FF6347;
        }

        .hero {
            text-align: center;
            margin: 40px 0;
        }

        .hero h1 {
            font-size: 36px;
            color: #FF6347;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 28px;
            }
            
            .photos-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: #999;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-item {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-item:hover {
            background: #f9f9f9;
        }

        .tab-item.active {
            color: #FF6347;
            border-bottom-color: #FF6347;
        }

        .badge {
            display: inline-block;
            background: #FF6347;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 6px;
        }

        /* ç”Ÿé•¿æ—¶é—´è½´æ ·å¼ */
        .photo-timeline {
            position: relative;
            padding-left: 40px;
            margin: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #FF6347, #4CAF50);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 32px;
        }

        .timeline-dot {
            position: absolute;
            left: -27px;
            top: 8px;
            width: 16px;
            height: 16px;
            background: #FF6347;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .timeline-content {
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .timeline-date {
            font-weight: bold;
            color: #FF6347;
            margin-bottom: 8px;
        }

        .timeline-photo {
            width: 100%;
            max-width: 300px;
            border-radius: 8px;
            margin-top: 12px;
            cursor: pointer;
        }

        /* ç”µå­ä¹¦é¢„è§ˆæ ·å¼ */
        .ebook-preview {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .ebook-cover {
            text-align: center;
            padding: 48px 24px;
            background: linear-gradient(135deg, #FF6347, #FFE4E1);
            border-radius: 12px;
            color: white;
            margin-bottom: 32px;
        }

        .ebook-page {
            page-break-after: always;
            margin-bottom: 32px;
            padding: 24px;
            border: 1px solid #f0f0f0;
            border-radius: 12px;
        }

        /* ===== æ–°å¢ï¼šæ•°æ®å½•å…¥é¡µé¢æ ·å¼ ===== */
        .data-entry-section {
            background: linear-gradient(135deg, #E0F7FA, #B2EBF2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .height-slider-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            padding: 24px;
            background: white;
            border-radius: 16px;
        }

        .ruler-marks {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 300px;
            text-align: right;
            font-size: 12px;
            color: #666;
        }

        .height-display {
            text-align: center;
        }

        .height-display .value {
            font-size: 48px;
            font-weight: bold;
            color: #FF6347;
        }

        .height-display .unit {
            font-size: 18px;
            color: #666;
        }

        .stepper-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .stepper-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .stepper-btn.minus {
            background: #f0f0f0;
            color: #666;
        }

        .stepper-btn.plus {
            background: #4CAF50;
            color: white;
        }

        .stepper-btn:hover {
            transform: scale(1.1);
        }

        .stepper-value {
            font-size: 32px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }

        /* ===== æ–°å¢ï¼šå¯è§†åŒ–é¡µé¢æ ·å¼ ===== */
        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-card.green { background: linear-gradient(135deg, #D1FAE5, #A7F3D0); }
        .stat-card.pink { background: linear-gradient(135deg, #FCE7F3, #FBCFE8); }
        .stat-card.orange { background: linear-gradient(135deg, #FED7AA, #FDBA74); }
        .stat-card.blue { background: linear-gradient(135deg, #DBEAFE, #BFDBFE); }
        .stat-card.purple { background: linear-gradient(135deg, #E9D5FF, #D8B4FE); }
        .stat-card.yellow { background: linear-gradient(135deg, #FEF3C7, #FDE68A); }
        .stat-card.red { background: linear-gradient(135deg, #FECACA, #FCA5A5); }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .insight-card {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .insight-emoji {
            font-size: 24px;
        }

        .insight-text {
            flex: 1;
            color: #92400E;
            line-height: 1.6;
        }

        /* ===== æ–°å¢ï¼šå­¦ç”Ÿä»ªè¡¨ç›˜æ ·å¼ ===== */
        .dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-avatar-large {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #FF6347, #FF4500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .user-details h2 {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .user-details p {
            color: #666;
        }

        .badge-list {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge-item {
            background: #FEF3C7;
            color: #92400E;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .progress-bar-container {
            margin-bottom: 24px;
        }

        .progress-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 16px;
            background: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 8px;
            transition: width 0.5s;
        }

        .tomato-display {
            background: linear-gradient(180deg, #87CEEB, #E0F7FA);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
        }

        .tomato-plant {
            font-size: 80px;
            animation: sway 3s ease-in-out infinite;
        }

        @keyframes sway {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .quick-stat {
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
        }

        .quick-stat-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .quick-stat-value {
            font-size: 20px;
            font-weight: bold;
        }

        .quick-stat-label {
            font-size: 12px;
            color: #666;
        }

        .task-card {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .task-pending {
            background: white;
            border: 2px dashed #FF6347;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }

        .task-completed {
            background: #D1FAE5;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .action-card {
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        .action-card.red { background: linear-gradient(135deg, #FF6347, #FF4500); }
        .action-card.green { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
        .action-card.blue { background: linear-gradient(135deg, #2196F3, #1565C0); }
        .action-card.purple { background: linear-gradient(135deg, #9C27B0, #6A1B9A); }

        .action-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .action-label {
            font-weight: bold;
            font-size: 16px;
        }

        /* ===== æ–°å¢ï¼šæ•™å¸ˆå…¨æ™¯ç›‘æ§æ ·å¼ ===== */
        .monitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .student-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .student-list-item:hover {
            background: #f0f0f0;
        }

        .student-list-item.selected {
            background: #FFE4E1;
            border: 2px solid #FF6347;
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-indicator.normal { background: #4CAF50; }
        .status-indicator.warning { background: #FFC107; }
        .status-indicator.error { background: #F44336; }

        .student-detail-panel {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .detail-section {
            margin-bottom: 24px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .error-alert {
            background: #FECACA;
            border: 2px solid #F87171;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .error-icon {
            font-size: 24px;
        }

        .error-content h4 {
            color: #DC2626;
            margin-bottom: 4px;
        }

        .error-content p {
            color: #991B1B;
            font-size: 14px;
        }

        /* ===== æ–°å¢ï¼šå†å²è®°å½•è¡¨æ ¼æ ·å¼ ===== */
        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .history-table th {
            background: #f9f9f9;
            font-weight: bold;
        }

        .history-table tr:hover {
            background: #f9f9f9;
        }

        .growth-positive {
            color: #4CAF50;
            font-weight: bold;
        }

        .growth-negative {
            color: #F44336;
            font-weight: bold;
        }

        /* ===== æ–°å¢ï¼šé¢„æµ‹å¼¹çª—æ ·å¼ ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            animation: modalIn 0.3s;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 24px;
        }

        /* ===== æ–°å¢ï¼šè¿”å›æŒ‰é’®æ ·å¼ ===== */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 24px;
            transition: all 0.2s;
        }

        .back-btn:hover {
            border-color: #FF6347;
            color: #FF6347;
        }

        /* ===== æ–°å¢ï¼šæµ®åŠ¨åŠ¨ç”» ===== */
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255,99,71,0.3); }
            50% { box-shadow: 0 0 40px rgba(255,99,71,0.6); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¦–é¡µ -->
        <div id="landing" class="page active">
            <div class="hero animate-float">
                <h1>ğŸ… ç•ªèŒ„ç‹å›½ ğŸ…</h1>
                <p style="font-size: 20px; color: #666; margin-bottom: 8px;">æ¬¢è¿æ¥åˆ°è‡ªç„¶ç¬”è®°</p>
                <p style="font-size: 16px; color: #999;">è®°å½•æˆé•¿ï¼Œè§è¯ç”Ÿå‘½çš„å¥‡è¿¹</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; max-width: 800px; margin: 0 auto 32px;">
                <!-- å­¦ç”Ÿå…¥å£ -->
                <div class="card card-hover" onclick="loginAsStudent()" style="cursor: pointer; text-align: center; padding: 32px;">
                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #2196F3, #1565C0); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                        <span style="font-size: 48px;">ğŸ”</span>
                    </div>
                    <h2 style="font-size: 28px; margin-bottom: 12px;">æˆ‘æ˜¯æ¢ç§˜è€…</h2>
                    <p style="color: #666; margin-bottom: 20px;">æ‹¿èµ·æ”¾å¤§é•œï¼Œå¼€å§‹æˆ‘çš„è§‚å¯Ÿæ—¥è®°</p>
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“±</div>
                    <button class="btn btn-primary" style="width: 100%;">è¿›å…¥æ¢ç§˜</button>
                </div>
                
                <!-- æ•™å¸ˆå…¥å£ -->
                <div class="card card-hover" onclick="loginAsTeacher()" style="cursor: pointer; text-align: center; padding: 32px;">
                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #9C27B0, #6A1B9A); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                        <span style="font-size: 48px;">ğŸ›¡ï¸</span>
                    </div>
                    <h2 style="font-size: 28px; margin-bottom: 12px;">æˆ‘æ˜¯å®ˆæŠ¤è€…</h2>
                    <p style="color: #666; margin-bottom: 20px;">ç”¨å¿ƒå®ˆæŠ¤ï¼Œè§è¯æ¯ä¸€ä¸ªæˆé•¿ç¬é—´</p>
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‘¨â€ğŸ«</div>
                    <button class="btn btn-secondary" style="width: 100%;">è¿›å…¥ç®¡ç†</button>
                </div>
            </div>

            <!-- å®æ—¶æ•°æ®è·‘é©¬ç¯ -->
            <div style="text-align: center;">
                <div class="animate-pulse-glow" style="display: inline-block; background: white; border-radius: 50px; padding: 16px 32px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <p style="font-size: 16px; color: #666;">
                        ğŸ‰ å…¨æ ¡å·²ç§æ¤ <span id="totalPlants" style="font-weight: bold; color: #FF6347;">0</span> æ£µç•ªèŒ„ï¼Œ
                        ç´¯è®¡é•¿é«˜ <span id="totalHeight" style="font-weight: bold; color: #4CAF50;">0</span> å˜ç±³ï¼
                    </p>
                </div>
            </div>
        </div>

        <!-- æ‹ç…§è®°å½•é¡µé¢ -->
        <div id="photo-capture" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ“¸ æ‹ç…§è®°å½•æˆé•¿</h2>
                
                <form onsubmit="savePhotoPost(event)">
                    <div style="margin-bottom: 24px;">
                        <label style="font-weight: bold; font-size: 18px; display: block; margin-bottom: 12px;">
                            ğŸ“· æ‹æ‘„ç…§ç‰‡
                        </label>
                        <input type="file" accept="image/*" capture="environment" id="photoInput" style="display: none;" onchange="handlePhotoSelect(event)">
                        <div class="photo-upload-btn" onclick="document.getElementById('photoInput').click()">
                            <div class="camera-icon">ğŸ“·</div>
                            <p style="font-size: 18px; font-weight: bold; color: #FF6347; margin-bottom: 8px;">
                                ç‚¹å‡»æ‹ç…§
                            </p>
                            <p style="color: #666; font-size: 14px;">
                                è®°å½•ç•ªèŒ„ä»Šå¤©çš„æ ·å­
                            </p>
                        </div>
                        <div id="photoPreview" style="margin-top: 16px;"></div>
                    </div>

                    <div class="note-prompts">
                        <div class="note-prompt-title">ğŸ“ è§‚å¯Ÿç¬”è®°å¼•å¯¼ï¼ˆè¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼‰</div>
                        <div class="note-prompt-item">ä»Šå¤©ç•ªèŒ„æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ</div>
                        <div class="note-prompt-item">æˆ‘è§‚å¯Ÿåˆ°äº†ä»€ä¹ˆæ–°å‘ç°ï¼Ÿ</div>
                        <div class="note-prompt-item">æˆ‘åšäº†ä»€ä¹ˆç…§é¡¾å·¥ä½œï¼Ÿ</div>
                        <div class="note-prompt-item">æˆ‘æœ‰ä»€ä¹ˆç–‘é—®æˆ–æƒ³æ³•ï¼Ÿ</div>
                    </div>

                    <div style="margin-bottom: 24px;">
                        <label style="font-weight: bold; font-size: 18px;">ğŸ“ æˆ‘çš„è§‚å¯Ÿç¬”è®°</label>
                        <textarea id="noteInput" rows="6" placeholder="è¯·æ ¹æ®ä¸Šé¢çš„é—®é¢˜ï¼Œå†™ä¸‹ä½ çš„è§‚å¯Ÿ...&#10;&#10;ä¾‹å¦‚ï¼š&#10;ä»Šå¤©ç•ªèŒ„é•¿é«˜äº†2å˜ç±³ï¼Œæˆ‘å‘ç°...&#10;æˆ‘ç»™å®ƒæµ‡äº†æ°´ï¼Œè¿˜...&#10;æˆ‘æƒ³çŸ¥é“ä¸ºä»€ä¹ˆ..." required></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <button type="button" class="btn btn-outline" onclick="showPage('my-photos')">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ğŸ“¤ å‘å¸ƒ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- æˆ‘çš„ç•ªèŒ„ -->
        <div id="my-photos" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 8px;">ğŸŒ± æˆ‘çš„ç•ªèŒ„</h2>
                <p style="color: #666; margin-bottom: 24px;">æˆ‘æ‹æ‘„çš„æˆé•¿è®°å½•</p>
                
                <div id="myPhotosList"></div>
            </div>
        </div>

        <!-- ç­çº§ç…§ç‰‡å¢™ -->
        <div id="class-wall" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ–¼ï¸ ç­çº§ç…§ç‰‡å¢™</h2>
                
                <div class="tab-nav">
                    <div class="tab-item active" onclick="filterPhotos('all')">å…¨éƒ¨</div>
                    <div class="tab-item" onclick="filterPhotos('recent')">æœ€æ–°</div>
                    <div class="tab-item" onclick="filterPhotos('popular')">çƒ­é—¨</div>
                </div>

                <div id="classPhotosList"></div>
            </div>
        </div>

        <!-- è®¨è®ºåŒº -->
        <div id="discussion" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ’¬ è®¨è®ºåŒº</h2>
                
                <div id="discussionList"></div>
            </div>
        </div>

        <!-- ç”Ÿé•¿æ—¶é—´è½´ -->
        <div id="timeline" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 8px;">ğŸ“… æˆ‘çš„ç”Ÿé•¿æ—¶é—´è½´</h2>
                <p style="color: #666; margin-bottom: 24px;">æŸ¥çœ‹ç•ªèŒ„çš„æ¯ä¸€å¤©</p>
                
                <div id="timelineContent" class="photo-timeline">
                    <div class="timeline-line"></div>
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“…</div>
                        <p>è¿˜æ²¡æœ‰è®°å½•</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç”µå­ä¹¦ç”Ÿæˆ -->
        <div id="ebook" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ“– ç”Ÿæˆæˆé•¿ç”µå­ä¹¦</h2>
                
                <div style="margin-bottom: 24px; text-align: center;">
                    <button class="btn btn-primary" onclick="generateEbook()" style="margin-right: 12px;">
                        ğŸ“š ç”Ÿæˆæˆ‘çš„ç”µå­ä¹¦
                    </button>
                    <button class="btn btn-secondary" onclick="downloadEbook()" id="downloadEbookBtn" style="display: none;">
                        ğŸ’¾ ä¸‹è½½ç”µå­ä¹¦
                    </button>
                </div>

                <div id="ebookPreview"></div>
            </div>
        </div>

        <!-- æ•™å¸ˆç«¯ -->
        <div id="teacher-panel" class="page">
            <div class="card">
                <h2 style="font-size: 24px; margin-bottom: 24px;">ğŸ‘¨â€ğŸ« æ•™å¸ˆç®¡ç†</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px;">
                    <div class="card" style="background: linear-gradient(135deg, #DBEAFE, #BFDBFE); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“¸</div>
                        <div style="font-size: 28px; font-weight: bold; color: #1e40af;" id="teacherTotalPhotos">0</div>
                        <div style="font-size: 14px; color: #666;">æ€»ç…§ç‰‡æ•°</div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #D1FAE5, #A7F3D0); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ‘¥</div>
                        <div style="font-size: 28px; font-weight: bold; color: #065f46;" id="teacherActiveStudents">0</div>
                        <div style="font-size: 14px; color: #666;">æ´»è·ƒå­¦ç”Ÿ</div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ’¬</div>
                        <div style="font-size: 28px; font-weight: bold; color: #92400e;" id="teacherTotalComments">0</div>
                        <div style="font-size: 14px; color: #666;">æ€»è¯„è®ºæ•°</div>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <button class="btn btn-primary" onclick="exportAllData()" style="width: 100%;">
                        ğŸ’¾ ä¸€é”®å¯¼å‡ºæ‰€æœ‰è®°å½•
                    </button>
                </div>

                <h3 style="margin-bottom: 16px;">å­¦ç”Ÿç…§ç‰‡åˆ—è¡¨</h3>
                <div id="teacherPhotosList"></div>
            </div>
        </div>

        <!-- ===== æ–°å¢ï¼šå­¦ç”Ÿä»ªè¡¨ç›˜é¡µé¢ ===== -->
        <div id="student-dashboard" class="page">
            <button class="back-btn" onclick="showPage('landing')">
                â† è¿”å›é¦–é¡µ
            </button>
            
            <div class="card">
                <div class="dashboard-header">
                    <div class="user-profile">
                        <div class="user-avatar-large" id="dashboardAvatar">ğŸ‘¦</div>
                        <div class="user-details">
                            <h2 id="dashboardName">å­¦ç”Ÿ</h2>
                            <p>ç­‰çº§ <span id="dashboardLevel">1</span> Â· å®šæ¤ç¬¬ <span id="dashboardDays">0</span> å¤©</p>
                        </div>
                    </div>
                    <div class="badge-list" id="dashboardBadges"></div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-top: 24px;">
                <!-- å·¦ä¾§ï¼šç•ªèŒ„çŠ¶æ€ -->
                <div>
                    <div class="card">
                        <h3 style="font-size: 20px; margin-bottom: 16px;">ğŸŒ± æˆ‘çš„ç•ªèŒ„</h3>
                        
                        <!-- ç”Ÿé•¿é˜¶æ®µ -->
                        <div class="progress-bar-container">
                            <div class="progress-bar-header">
                                <span id="stageEmoji">ğŸŒ±</span>
                                <span id="stageName">å¹¼è‹—æœŸ</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-bar-fill" id="stageProgress" style="width: 0%"></div>
                            </div>
                            <p style="text-align: right; font-size: 14px; color: #666; margin-top: 4px;">
                                <span id="stagePercent">0</span>%
                            </p>
                        </div>

                        <!-- ç•ªèŒ„åŠ¨ç”» -->
                        <div class="tomato-display">
                            <div class="tomato-plant" id="tomatoPlant">ğŸŒ±</div>
                            <div style="margin-top: 16px; background: linear-gradient(180deg, #8B4513, #654321); height: 40px; border-radius: 8px 8px 0 0;"></div>
                        </div>

                        <!-- å¿«é€Ÿæ•°æ® -->
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <div class="quick-stat-icon">ğŸ“</div>
                                <div class="quick-stat-value" id="quickHeight">0</div>
                                <div class="quick-stat-label">æ ªé«˜(cm)</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-icon">ğŸƒ</div>
                                <div class="quick-stat-value" id="quickLeaves">0</div>
                                <div class="quick-stat-label">å¶ç‰‡</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-icon">ğŸŒ¸</div>
                                <div class="quick-stat-value" id="quickFlowers">0</div>
                                <div class="quick-stat-label">èŠ±æœµ</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-icon">ğŸ…</div>
                                <div class="quick-stat-value" id="quickFruits">0</div>
                                <div class="quick-stat-label">æœå®</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šä»»åŠ¡å’Œæ“ä½œ -->
                <div>
                    <!-- ä»Šæ—¥ä»»åŠ¡ -->
                    <div class="task-card">
                        <h3 style="font-size: 20px; margin-bottom: 16px;">ğŸ“‹ ä»Šæ—¥ä»»åŠ¡</h3>
                        <div id="dailyTask"></div>
                    </div>

                    <!-- å¿«æ·æ“ä½œ -->
                    <div class="card">
                        <h3 style="font-size: 20px; margin-bottom: 16px;">å¿«æ·æ“ä½œ</h3>
                        <div class="action-grid">
                            <div class="action-card red" onclick="showPage('data-entry')">
                                <div class="action-icon">ğŸ“Š</div>
                                <div class="action-label">è®°å½•æ•°æ®</div>
                            </div>
                            <div class="action-card green" onclick="showPage('visualization')">
                                <div class="action-icon">ğŸ“ˆ</div>
                                <div class="action-label">æŸ¥çœ‹å›¾è¡¨</div>
                            </div>
                            <div class="action-card blue" onclick="showPage('photo-capture')">
                                <div class="action-icon">ğŸ“¸</div>
                                <div class="action-label">æ‹ç…§è®°å½•</div>
                            </div>
                            <div class="action-card purple" onclick="showPage('class-wall')">
                                <div class="action-icon">ğŸ–¼ï¸</div>
                                <div class="action-label">ç­çº§ç…§ç‰‡å¢™</div>
                            </div>
                        </div>
                    </div>

                    <!-- æˆå°±å¾½ç«  -->
                    <div class="card" style="margin-top: 24px;">
                        <h3 style="font-size: 20px; margin-bottom: 16px;">ğŸ† æˆ‘çš„æˆå°±</h3>
                        <div id="achievementList" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== æ–°å¢ï¼šæ•°æ®å½•å…¥é¡µé¢ ===== -->
        <div id="data-entry" class="page">
            <button class="back-btn" onclick="showPage('student-dashboard')">
                â† è¿”å›æ§åˆ¶å°
            </button>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="font-size: 28px;">ğŸ”¬ ç”Ÿé•¿è®°å½•å®éªŒå®¤</h2>
                    <span style="font-size: 18px; color: #666;">å®šæ¤ç¬¬ <span id="entryDays" style="font-weight: bold; color: #FF6347;">0</span> å¤©</span>
                </div>

                <form id="dataEntryForm" onsubmit="submitDataEntry(event)">
                    <!-- æ—¥æœŸé€‰æ‹© -->
                    <div style="margin-bottom: 24px;">
                        <label style="font-size: 18px; font-weight: bold; display: block; margin-bottom: 8px;">ğŸ“… è®°å½•æ—¥æœŸ</label>
                        <input type="date" id="entryDate" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px;">
                    </div>

                    <!-- æ ªé«˜æµ‹é‡ -->
                    <div class="data-entry-section">
                        <label style="font-size: 18px; font-weight: bold; display: block; margin-bottom: 16px;">ğŸ“ æ ªé«˜æµ‹é‡</label>
                        <div class="height-slider-container">
                            <div class="ruler-marks">
                                <span>100cm</span>
                                <span>80cm</span>
                                <span>60cm</span>
                                <span>40cm</span>
                                <span>20cm</span>
                                <span>0cm</span>
                            </div>
                            <input type="range" id="heightSlider" min="0" max="100" value="20" 
                                   style="writing-mode: bt-lr; -webkit-appearance: slider-vertical; appearance: slider-vertical; width: 40px; height: 300px;"
                                   oninput="updateHeightDisplay()">
                            <div style="font-size: 60px; transition: all 0.3s;" id="plantVisual">ğŸŒ±</div>
                            <div class="height-display">
                                <div class="value" id="heightValue">20</div>
                                <div class="unit">å˜ç±³</div>
                            </div>
                        </div>
                    </div>

                    <!-- å¶ç‰‡ã€èŠ±ã€æœè®¡æ•° -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div class="card" style="text-align: center;">
                            <div style="font-size: 36px; margin-bottom: 8px;">ğŸƒ</div>
                            <div style="font-weight: bold; margin-bottom: 12px;">å¶ç‰‡æ•°</div>
                            <div class="stepper-control">
                                <button type="button" class="stepper-btn minus" onclick="adjustValue('leaves', -1)">âˆ’</button>
                                <span class="stepper-value" id="leavesValue">4</span>
                                <button type="button" class="stepper-btn plus" onclick="adjustValue('leaves', 1)">+</button>
                            </div>
                        </div>
                        <div class="card" style="text-align: center;">
                            <div style="font-size: 36px; margin-bottom: 8px;">ğŸŒ¸</div>
                            <div style="font-weight: bold; margin-bottom: 12px;">èŠ±æœµæ•°</div>
                            <div class="stepper-control">
                                <button type="button" class="stepper-btn minus" onclick="adjustValue('flowers', -1)">âˆ’</button>
                                <span class="stepper-value" id="flowersValue">0</span>
                                <button type="button" class="stepper-btn plus" onclick="adjustValue('flowers', 1)">+</button>
                            </div>
                        </div>
                        <div class="card" style="text-align: center;">
                            <div style="font-size: 36px; margin-bottom: 8px;">ğŸ…</div>
                            <div style="font-weight: bold; margin-bottom: 12px;">æœå®æ•°</div>
                            <div class="stepper-control">
                                <button type="button" class="stepper-btn minus" onclick="adjustValue('fruits', -1)">âˆ’</button>
                                <span class="stepper-value" id="fruitsValue">0</span>
                                <button type="button" class="stepper-btn plus" onclick="adjustValue('fruits', 1)">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- æ‹ç…§è®°å½• -->
                    <div style="margin-bottom: 24px;">
                        <label style="font-size: 18px; font-weight: bold; display: block; margin-bottom: 8px;">ğŸ“¸ æ‹ç…§è®°å½•</label>
                        <input type="file" accept="image/*" id="entryPhotoInput" style="display: none;" onchange="handleEntryPhoto(event)">
                        <div onclick="document.getElementById('entryPhotoInput').click()" 
                             style="border: 2px dashed #ddd; border-radius: 16px; padding: 32px; text-align: center; cursor: pointer; background: linear-gradient(135deg, #F3E8FF, #E9D5FF);">
                            <div id="entryPhotoPreview">
                                <div style="font-size: 48px; margin-bottom: 8px;">ğŸ“·</div>
                                <p style="color: #666;">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</p>
                            </div>
                        </div>
                    </div>

                    <!-- è§‚å¯Ÿç¬”è®° -->
                    <div style="margin-bottom: 24px;">
                        <label style="font-size: 18px; font-weight: bold; display: block; margin-bottom: 8px;">ğŸ“ è§‚å¯Ÿç¬”è®°</label>
                        <textarea id="entryNotes" rows="4" placeholder="ä»Šå¤©ç•ªèŒ„æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿæˆ‘åšäº†ä»€ä¹ˆ..." 
                                  style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; resize: none;"></textarea>
                    </div>

                    <!-- æäº¤æŒ‰é’® -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <button type="button" class="btn btn-outline" onclick="showPage('student-dashboard')">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ğŸ’¾ ä¿å­˜è®°å½•</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ===== æ–°å¢ï¼šæ•°æ®å¯è§†åŒ–é¡µé¢ ===== -->
        <div id="visualization" class="page">
            <button class="back-btn" onclick="showPage('student-dashboard')">
                â† è¿”å›æ§åˆ¶å°
            </button>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="font-size: 28px;">ğŸ“ˆ æ•°æ®å¯è§†åŒ–å¤§å…</h2>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="showClassAvg" onchange="toggleClassAverage()" style="width: 20px; height: 20px;">
                        <span>æ˜¾ç¤ºå…¨ç­å¹³å‡</span>
                    </label>
                </div>

                <!-- ç”Ÿé•¿æ›²çº¿å›¾ -->
                <div class="chart-container">
                    <h3 style="margin-bottom: 16px;">ğŸ“ˆ æ ªé«˜ç”Ÿé•¿æ›²çº¿</h3>
                    <div class="chart-wrapper">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>

                <!-- å¤šæŒ‡æ ‡ç»Ÿè®¡ -->
                <div class="stats-grid">
                    <div class="stat-card green">
                        <div class="stat-icon">ğŸƒ</div>
                        <div class="stat-value" id="vizLeaves">0</div>
                        <div class="stat-label">å¶ç‰‡æ€»æ•°</div>
                    </div>
                    <div class="stat-card pink">
                        <div class="stat-icon">ğŸŒ¸</div>
                        <div class="stat-value" id="vizFlowers">0</div>
                        <div class="stat-label">èŠ±æœµæ€»æ•°</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon">ğŸ…</div>
                        <div class="stat-value" id="vizFruits">0</div>
                        <div class="stat-label">æœå®æ€»æ•°</div>
                    </div>
                </div>

                <!-- æ™ºèƒ½æ´å¯Ÿ -->
                <div style="margin-bottom: 24px;">
                    <h3 style="margin-bottom: 16px;">ğŸ’¡ æ•°æ®æ´å¯Ÿ</h3>
                    <div id="insightsList"></div>
                </div>

                <!-- å†å²è®°å½•è¡¨æ ¼ -->
                <div>
                    <h3 style="margin-bottom: 16px;">ğŸ“‹ å†å²è®°å½•</h3>
                    <div style="overflow-x: auto;">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>æ—¥æœŸ</th>
                                    <th>å¤©æ•°</th>
                                    <th>æ ªé«˜</th>
                                    <th>å¶ç‰‡</th>
                                    <th>èŠ±æœµ</th>
                                    <th>æœå®</th>
                                    <th>å¢é•¿</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== æ–°å¢ï¼šæ•™å¸ˆå…¨æ™¯ç›‘æ§é¡µé¢ ===== -->
        <div id="teacher-monitor" class="page">
            <button class="back-btn" onclick="showPage('landing')">
                â† è¿”å›é¦–é¡µ
            </button>

            <div style="margin-bottom: 24px;">
                <h1 style="font-size: 32px; margin-bottom: 8px;">ğŸ¯ å…¨æ™¯ç›‘æ§èˆ±</h1>
                <p style="color: #666;">ç­çº§ç•ªèŒ„ç§æ¤å…¨æ™¯ç®¡ç†</p>
            </div>

            <!-- æ•°æ®æ¦‚è§ˆ -->
            <div class="monitor-grid">
                <div class="stat-card blue">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-value" id="monitorTotal">0</div>
                    <div class="stat-label">å­¦ç”Ÿæ€»æ•°</div>
                </div>
                <div class="stat-card green">
                    <div class="stat-icon">âœ…</div>
                    <div class="stat-value" id="monitorActive">0</div>
                    <div class="stat-label">æ­£å¸¸è®°å½•</div>
                </div>
                <div class="stat-card yellow">
                    <div class="stat-icon">âš ï¸</div>
                    <div class="stat-value" id="monitorWarning">0</div>
                    <div class="stat-label">å¾…æé†’</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-icon">ğŸš¨</div>
                    <div class="stat-value" id="monitorError">0</div>
                    <div class="stat-label">æ•°æ®å¼‚å¸¸</div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-icon">ğŸ“</div>
                    <div class="stat-value" id="monitorAvgHeight">0</div>
                    <div class="stat-label">å¹³å‡æ ªé«˜(cm)</div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
                <!-- å­¦ç”Ÿåˆ—è¡¨ -->
                <div class="card">
                    <h2 style="font-size: 24px; margin-bottom: 24px;">å­¦ç”Ÿåˆ—è¡¨</h2>
                    <div id="monitorStudentList"></div>
                </div>

                <!-- å­¦ç”Ÿè¯¦æƒ…é¢æ¿ -->
                <div class="student-detail-panel" id="studentDetailPanel">
                    <div id="studentDetailContent" style="text-align: center; padding: 48px; color: #999;">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‘ˆ</div>
                        <p>é€‰æ‹©ä¸€ä¸ªå­¦ç”ŸæŸ¥çœ‹è¯¦æƒ…</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <div class="nav-item active" onclick="showPage('student-dashboard')" data-page="student-dashboard">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-label">é¦–é¡µ</span>
        </div>
        <div class="nav-item" onclick="showPage('data-entry')" data-page="data-entry">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-label">è®°å½•</span>
        </div>
        <div class="nav-item" onclick="showPage('visualization')" data-page="visualization">
            <span class="nav-icon">ğŸ“ˆ</span>
            <span class="nav-label">å›¾è¡¨</span>
        </div>
        <div class="nav-item" onclick="showPage('photo-capture')" data-page="photo-capture">
            <span class="nav-icon">ğŸ“¸</span>
            <span class="nav-label">æ‹ç…§</span>
        </div>
        <div class="nav-item" onclick="showPage('class-wall')" data-page="class-wall">
            <span class="nav-icon">ğŸ–¼ï¸</span>
            <span class="nav-label">ç…§ç‰‡å¢™</span>
        </div>
    </div>

    <!-- é¢„æµ‹å¼¹çª— -->
    <div class="modal-overlay" id="predictionModal">
        <div class="modal-content">
            <h3 class="modal-title">ğŸ¤” æ¢ç©¶æ€§æé—®</h3>
            <p style="font-size: 18px;">ä½ é¢„æµ‹ä»Šå¤©ç•ªèŒ„é•¿é«˜äº†å—ï¼Ÿ</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="answerPrediction(true)">ğŸ‘ æ˜¯çš„ï¼Œé•¿é«˜äº†</button>
                <button class="btn btn-outline" onclick="answerPrediction(false)">ğŸ‘ æ²¡æœ‰å˜åŒ–</button>
            </div>
        </div>
    </div>

    <!-- ç…§ç‰‡ç¯ç®± -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <div class="lightbox-content" onclick="event.stopPropagation()">
            <div class="lightbox-close" onclick="closeLightbox()">Ã—</div>
            <img class="lightbox-image" id="lightboxImage" src="" alt="">
        </div>
    </div>

    <script>
        // æ•°æ®æ¨¡å‹ - æ•´åˆç‰ˆ
        let appData = {
            currentUser: null,
            photos: [],
            comments: [],
            students: [
                { id: 1, name: 'å°æ˜', avatar: 'ğŸ‘¦', level: 5, plantingDate: '2024-01-01', records: [], badges: ['å…¨å‹¤è®°å½•å¥–', 'åˆæ¬¡å¼€èŠ±çºªå¿µ'] },
                { id: 2, name: 'å°çº¢', avatar: 'ğŸ‘§', level: 4, plantingDate: '2024-01-01', records: [], badges: ['å…¨å‹¤è®°å½•å¥–'] },
                { id: 3, name: 'å°åˆš', avatar: 'ğŸ‘¨', level: 3, plantingDate: '2024-01-05', records: [], badges: [] },
                { id: 4, name: 'å°ç¾', avatar: 'ğŸ‘©', level: 4, plantingDate: '2024-01-03', records: [], badges: ['è§‚å¯Ÿè¾¾äºº'] },
            ],
            currentPhoto: null,
            entryPhoto: null,
            prediction: null,
            selectedStudentId: null,
            growthChart: null
        };

        // åˆå§‹åŒ–
        function init() {
            loadFromLocalStorage();
            generateSampleData();
            updateLandingStats();
        }

        // æ›´æ–°é¦–é¡µç»Ÿè®¡
        function updateLandingStats() {
            const totalPlants = appData.students.length;
            let totalHeight = 0;
            appData.students.forEach(s => {
                if (s.records && s.records.length > 0) {
                    totalHeight += s.records[s.records.length - 1].height || 0;
                }
            });
            document.getElementById('totalPlants').textContent = totalPlants;
            document.getElementById('totalHeight').textContent = totalHeight;
        }

        // ç”Ÿæˆç¤ºä¾‹æ•°æ®
        function generateSampleData() {
            // ç”Ÿæˆç…§ç‰‡æ•°æ®
            if (appData.photos.length === 0) {
                const now = Date.now();
                for (let i = 0; i < 6; i++) {
                    const studentId = (i % 4) + 1;
                    appData.photos.push({
                        id: Date.now() + i,
                        studentId: studentId,
                        photo: `data:image/svg+xml;base64,${btoa(`<svg width="400" height="400" xmlns="http://www.w3.org/2000/svg"><rect width="400" height="400" fill="#${['FFE4E1', 'E0F2FE', 'D1FAE5', 'FEF3C7'][i % 4]}"/><text x="50%" y="45%" font-size="80" text-anchor="middle" dy=".3em">ğŸ…</text><text x="50%" y="65%" font-size="20" text-anchor="middle" fill="#666">ç¬¬${i + 1}å¤©</text></svg>`)}`,
                        note: `ä»Šå¤©ç•ªèŒ„é•¿é«˜äº†ä¸€ç‚¹ï¼Œæˆ‘è§‚å¯Ÿåˆ°${['å¶ç‰‡æ›´ç»¿äº†', 'å¼€äº†å°èŠ±', 'ç»“äº†æœå®', 'èŒå˜ç²—äº†'][i % 4]}ã€‚æˆ‘ç»™å®ƒæµ‡äº†æ°´ï¼Œå¸Œæœ›å®ƒèƒ½å¥åº·æˆé•¿ï¼`,
                        timestamp: now - (6 - i) * 24 * 60 * 60 * 1000,
                        likes: Math.floor(Math.random() * 10),
                        likedBy: []
                    });
                }
            }

            // ç”Ÿæˆç”Ÿé•¿è®°å½•æ•°æ®
            appData.students.forEach(student => {
                if (!student.records || student.records.length === 0) {
                    student.records = generateSampleRecords(student.plantingDate, 15);
                }
            });
            saveToLocalStorage();
        }

        // ç”Ÿæˆç¤ºä¾‹è®°å½•
        function generateSampleRecords(startDate, count) {
            const records = [];
            const start = new Date(startDate);
            
            for (let i = 0; i < count; i++) {
                const date = new Date(start);
                date.setDate(date.getDate() + i);
                
                records.push({
                    date: date.toISOString().split('T')[0],
                    height: Math.floor(5 + i * 1.5 + Math.random() * 2),
                    leaves: Math.floor(2 + i * 0.5),
                    flowers: i > 10 ? Math.floor(Math.random() * 3) : 0,
                    fruits: i > 12 ? Math.floor(Math.random() * 2) : 0,
                    photo: null,
                    notes: ''
                });
            }
            
            return records;
        }

        // LocalStorage
        function saveToLocalStorage() {
            localStorage.setItem('tomatoSocial', JSON.stringify(appData));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('tomatoSocial');
            if (saved) {
                appData = { ...appData, ...JSON.parse(saved) };
            }
        }

        // ç™»å½•
        function loginAsStudent() {
            const studentId = prompt('è¯·è¾“å…¥ä½ çš„å­¦å·ï¼ˆ1-4ï¼‰ï¼š');
            if (studentId && studentId >= 1 && studentId <= 4) {
                appData.currentUser = {
                    id: parseInt(studentId),
                    role: 'student',
                    ...appData.students[studentId - 1]
                };
                document.getElementById('bottomNav').style.display = 'flex';
                showPage('student-dashboard');
            }
        }

        function loginAsTeacher() {
            appData.currentUser = {
                id: 999,
                role: 'teacher',
                name: 'ç‹è€å¸ˆ',
                avatar: 'ğŸ‘¨â€ğŸ«'
            };
            document.getElementById('bottomNav').style.display = 'none';
            showPage('teacher-monitor');
        }

        // é¡µé¢å¯¼èˆª
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // æ›´æ–°åº•éƒ¨å¯¼èˆªé«˜äº®
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === pageId) {
                    item.classList.add('active');
                }
            });

            // åŠ è½½å¯¹åº”é¡µé¢å†…å®¹
            if (pageId === 'landing') updateLandingStats();
            if (pageId === 'student-dashboard') loadStudentDashboard();
            if (pageId === 'data-entry') loadDataEntry();
            if (pageId === 'visualization') loadVisualization();
            if (pageId === 'my-photos') loadMyPhotos();
            if (pageId === 'class-wall') loadClassWall();
            if (pageId === 'discussion') loadDiscussion();
            if (pageId === 'timeline') loadTimeline();
            if (pageId === 'teacher-panel') loadTeacherPanel();
            if (pageId === 'teacher-monitor') loadTeacherMonitor();
            if (pageId === 'ebook') {
                document.getElementById('ebookPreview').innerHTML = '';
                document.getElementById('downloadEbookBtn').style.display = 'none';
            }
            
            window.scrollTo(0, 0);
        }

        // ===== å·¥å…·å‡½æ•° =====
        function getDaysSincePlanting(plantingDate) {
            const today = new Date();
            const planting = new Date(plantingDate);
            const diffTime = Math.abs(today - planting);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function getGrowthStage(days) {
            if (days < 7) return { name: 'å¹¼è‹—æœŸ', emoji: 'ğŸŒ±', progress: (days / 7) * 100 };
            if (days < 30) return { name: 'æˆé•¿æœŸ', emoji: 'ğŸŒ¿', progress: ((days - 7) / 23) * 100 };
            if (days < 50) return { name: 'å¼€èŠ±æœŸ', emoji: 'ğŸŒ¸', progress: ((days - 30) / 20) * 100 };
            return { name: 'ç»“æœæœŸ', emoji: 'ğŸ…', progress: Math.min(((days - 50) / 30) * 100, 100) };
        }

        function getCurrentStudent() {
            return appData.students.find(s => s.id === appData.currentUser?.id);
        }

        // ===== å­¦ç”Ÿä»ªè¡¨ç›˜ =====
        function loadStudentDashboard() {
            const student = getCurrentStudent();
            if (!student) return;

            const days = getDaysSincePlanting(student.plantingDate);
            const stage = getGrowthStage(days);
            const lastRecord = student.records[student.records.length - 1] || {};

            // æ›´æ–°å¤´éƒ¨ä¿¡æ¯
            document.getElementById('dashboardAvatar').textContent = student.avatar;
            document.getElementById('dashboardName').textContent = student.name;
            document.getElementById('dashboardLevel').textContent = student.level;
            document.getElementById('dashboardDays').textContent = days;

            // æ›´æ–°å¾½ç« 
            const badgesHtml = (student.badges || []).map(b => 
                `<span class="badge-item">ğŸ† ${b}</span>`
            ).join('');
            document.getElementById('dashboardBadges').innerHTML = badgesHtml;

            // æ›´æ–°ç”Ÿé•¿é˜¶æ®µ
            document.getElementById('stageEmoji').textContent = stage.emoji;
            document.getElementById('stageName').textContent = stage.name;
            document.getElementById('stageProgress').style.width = stage.progress + '%';
            document.getElementById('stagePercent').textContent = Math.round(stage.progress);

            // æ›´æ–°ç•ªèŒ„æ¤æ ªæ˜¾ç¤º
            const plantEmoji = days < 7 ? 'ğŸŒ±' : days < 30 ? 'ğŸŒ¿' : days < 50 ? 'ğŸŒ¸' : 'ğŸ…';
            document.getElementById('tomatoPlant').textContent = plantEmoji;

            // æ›´æ–°å¿«é€Ÿæ•°æ®
            document.getElementById('quickHeight').textContent = lastRecord.height || 0;
            document.getElementById('quickLeaves').textContent = lastRecord.leaves || 0;
            document.getElementById('quickFlowers').textContent = lastRecord.flowers || 0;
            document.getElementById('quickFruits').textContent = lastRecord.fruits || 0;

            // æ›´æ–°ä»Šæ—¥ä»»åŠ¡
            const today = new Date().toISOString().split('T')[0];
            const hasRecordToday = student.records.some(r => r.date === today);
            
            const taskHtml = hasRecordToday ? `
                <div class="task-completed">
                    <p style="font-size: 18px; margin-bottom: 8px;">âœ… ä»Šæ—¥ä»»åŠ¡å·²å®Œæˆï¼</p>
                    <p style="color: #666;">ç»§ç»­ä¿æŒï¼Œæ˜å¤©è§ï¼</p>
                </div>
            ` : `
                <div class="task-pending">
                    <p style="font-size: 18px; margin-bottom: 12px;">ğŸŒ± ä»»åŠ¡ï¼šå»çœ‹çœ‹ä½ çš„ç•ªèŒ„æ€ä¹ˆæ ·äº†ï¼Ÿ</p>
                    <p style="color: #666; margin-bottom: 16px;">ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•æ•°æ®å“¦ï¼</p>
                    <button class="btn btn-primary" onclick="showPage('data-entry')">å¼€å§‹è®°å½•</button>
                </div>
            `;
            document.getElementById('dailyTask').innerHTML = taskHtml;

            // æ›´æ–°æˆå°±åˆ—è¡¨
            const achievements = (student.badges || []).map(b => `
                <div style="text-align: center;">
                    <div style="width: 60px; height: 60px; background: #FEF3C7; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; margin: 0 auto 8px;">ğŸ†</div>
                    <p style="font-size: 12px; color: #666;">${b}</p>
                </div>
            `).join('');
            
            const lockedAchievement = `
                <div style="text-align: center; opacity: 0.5;">
                    <div style="width: 60px; height: 60px; background: #f0f0f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; margin: 0 auto 8px;">â“</div>
                    <p style="font-size: 12px; color: #999;">å¾…è§£é”</p>
                </div>
            `;
            document.getElementById('achievementList').innerHTML = achievements + lockedAchievement;
        }

        // ===== æ•°æ®å½•å…¥ =====
        function loadDataEntry() {
            const student = getCurrentStudent();
            if (!student) return;

            const days = getDaysSincePlanting(student.plantingDate);
            document.getElementById('entryDays').textContent = days;
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('entryDate').max = new Date().toISOString().split('T')[0];

            // é¢„å¡«å……ä¸Šæ¬¡æ•°æ®
            const lastRecord = student.records[student.records.length - 1];
            if (lastRecord) {
                document.getElementById('heightSlider').value = lastRecord.height + 1;
                document.getElementById('heightValue').textContent = lastRecord.height + 1;
                document.getElementById('leavesValue').textContent = lastRecord.leaves;
                document.getElementById('flowersValue').textContent = lastRecord.flowers;
                document.getElementById('fruitsValue').textContent = lastRecord.fruits;
            }

            // é‡ç½®ç…§ç‰‡é¢„è§ˆ
            document.getElementById('entryPhotoPreview').innerHTML = `
                <div style="font-size: 48px; margin-bottom: 8px;">ğŸ“·</div>
                <p style="color: #666;">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</p>
            `;
            appData.entryPhoto = null;

            // æ˜¾ç¤ºé¢„æµ‹å¼¹çª—
            document.getElementById('predictionModal').classList.add('active');
        }

        function updateHeightDisplay() {
            const value = document.getElementById('heightSlider').value;
            document.getElementById('heightValue').textContent = value;
            
            // æ›´æ–°æ¤ç‰©å›¾æ ‡
            const plantVisual = document.getElementById('plantVisual');
            if (value < 20) plantVisual.textContent = 'ğŸŒ±';
            else if (value < 40) plantVisual.textContent = 'ğŸŒ¿';
            else if (value < 60) plantVisual.textContent = 'ğŸŒ¸';
            else plantVisual.textContent = 'ğŸ…';
        }

        function adjustValue(field, delta) {
            const elem = document.getElementById(field + 'Value');
            const current = parseInt(elem.textContent);
            elem.textContent = Math.max(0, current + delta);
        }

        function handleEntryPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                appData.entryPhoto = e.target.result;
                document.getElementById('entryPhotoPreview').innerHTML = `
                    <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 12px;">
                `;
            };
            reader.readAsDataURL(file);
        }

        function answerPrediction(willGrow) {
            appData.prediction = willGrow;
            document.getElementById('predictionModal').classList.remove('active');
        }

        function submitDataEntry(e) {
            e.preventDefault();
            
            const student = getCurrentStudent();
            if (!student) return;

            const height = parseInt(document.getElementById('heightSlider').value);
            const lastRecord = student.records[student.records.length - 1];

            // éªŒè¯æ•°æ®
            if (lastRecord && height < lastRecord.height - 5) {
                alert('âš ï¸ æ•°æ®å¯èƒ½æœ‰è¯¯ï¼šç•ªèŒ„ä¸å¤ªå¯èƒ½ä¸€å¤œä¹‹é—´å˜çŸ®å“¦ï¼');
                return;
            }

            const newRecord = {
                date: document.getElementById('entryDate').value,
                height: height,
                leaves: parseInt(document.getElementById('leavesValue').textContent),
                flowers: parseInt(document.getElementById('flowersValue').textContent),
                fruits: parseInt(document.getElementById('fruitsValue').textContent),
                photo: appData.entryPhoto,
                notes: document.getElementById('entryNotes').value
            };

            student.records.push(newRecord);
            saveToLocalStorage();

            // æ˜¾ç¤ºé¢„æµ‹åé¦ˆ
            if (appData.prediction !== null && lastRecord) {
                const actualGrowth = height - lastRecord.height;
                const correct = (appData.prediction && actualGrowth > 0) || (!appData.prediction && actualGrowth <= 0);
                
                setTimeout(() => {
                    alert(correct 
                        ? `ğŸ‰ å“‡ï¼æ¯”æ˜¨å¤©é•¿äº† ${actualGrowth}cmï¼Œä½ çš„é¢„æµ‹æ˜¯å¯¹çš„ï¼`
                        : `ğŸ¤” æ¯”æ˜¨å¤©é•¿äº† ${actualGrowth}cmï¼Œå’Œé¢„æµ‹ä¸å¤ªä¸€æ ·å‘¢ã€‚ä¸‹æ¬¡å†è§‚å¯Ÿçœ‹çœ‹ï¼`
                    );
                }, 300);
            }

            appData.prediction = null;
            alert('âœ… è®°å½•ä¿å­˜æˆåŠŸï¼');
            showPage('student-dashboard');
        }

        // ===== æ•°æ®å¯è§†åŒ– =====
        function loadVisualization() {
            const student = getCurrentStudent();
            if (!student || !student.records.length) return;

            const records = student.records;
            const lastRecord = records[records.length - 1];

            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
            document.getElementById('vizLeaves').textContent = lastRecord.leaves || 0;
            document.getElementById('vizFlowers').textContent = lastRecord.flowers || 0;
            document.getElementById('vizFruits').textContent = lastRecord.fruits || 0;

            // ç»˜åˆ¶å›¾è¡¨
            drawGrowthChart(records);

            // ç”Ÿæˆæ´å¯Ÿ
            generateInsights(records);

            // å¡«å……å†å²è¡¨æ ¼
            fillHistoryTable(records);
        }

        function drawGrowthChart(records) {
            const ctx = document.getElementById('growthChart').getContext('2d');
            
            // é”€æ¯æ—§å›¾è¡¨
            if (appData.growthChart) {
                appData.growthChart.destroy();
            }

            const labels = records.map((r, i) => `ç¬¬${i + 1}å¤©`);
            const heights = records.map(r => r.height);

            const datasets = [{
                label: 'æˆ‘çš„ç•ªèŒ„',
                data: heights,
                borderColor: '#FF6347',
                backgroundColor: 'rgba(255, 99, 71, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.3,
                pointRadius: 6,
                pointBackgroundColor: '#FF6347'
            }];

            // æ·»åŠ å…¨ç­å¹³å‡çº¿
            if (document.getElementById('showClassAvg').checked) {
                const avgHeights = records.map((_, i) => {
                    let sum = 0, count = 0;
                    appData.students.forEach(s => {
                        if (s.records[i]) {
                            sum += s.records[i].height;
                            count++;
                        }
                    });
                    return count > 0 ? sum / count : 0;
                });

                datasets.push({
                    label: 'å…¨ç­å¹³å‡',
                    data: avgHeights,
                    borderColor: '#999',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: '#999'
                });
            }

            appData.growthChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'é«˜åº¦ (cm)' }
                        },
                        x: {
                            title: { display: true, text: 'å¤©æ•°' }
                        }
                    }
                }
            });
        }

        function toggleClassAverage() {
            const student = getCurrentStudent();
            if (student && student.records.length) {
                drawGrowthChart(student.records);
            }
        }

        function generateInsights(records) {
            const insights = [];
            
            if (records.length < 2) {
                document.getElementById('insightsList').innerHTML = '<p style="color: #666;">è®°å½•æ›´å¤šæ•°æ®åå°†æ˜¾ç¤ºæ™ºèƒ½æ´å¯Ÿ</p>';
                return;
            }

            // æ‰¾å‡ºç”Ÿé•¿æœ€å¿«çš„æ—¶æœŸ
            let maxGrowth = 0, maxPeriod = { start: 0, end: 0 };
            for (let i = 1; i < records.length; i++) {
                const growth = records[i].height - records[i - 1].height;
                if (growth > maxGrowth) {
                    maxGrowth = growth;
                    maxPeriod = { start: i, end: i + 1 };
                }
            }
            if (maxGrowth > 0) {
                insights.push({
                    emoji: 'ğŸ“ˆ',
                    text: `ä½ çš„ç•ªèŒ„åœ¨ç¬¬${maxPeriod.start}å¤©åˆ°ç¬¬${maxPeriod.end}å¤©ç”Ÿé•¿é€Ÿåº¦æœ€å¿«ï¼Œé•¿äº†${maxGrowth}cmï¼`
                });
            }

            // å¼€èŠ±æ—¶é—´
            const firstFlower = records.findIndex(r => r.flowers > 0);
            if (firstFlower !== -1) {
                insights.push({
                    emoji: 'ğŸ‰',
                    text: `æ­å–œï¼ä½ çš„ç•ªèŒ„åœ¨ç¬¬${firstFlower + 1}å¤©å¼€å‡ºäº†ç¬¬ä¸€æœµèŠ± ğŸŒ¸`
                });
            }

            // ç»“æœæ—¶é—´
            const firstFruit = records.findIndex(r => r.fruits > 0);
            if (firstFruit !== -1) {
                insights.push({
                    emoji: 'ğŸŠ',
                    text: `å¤ªæ£’äº†ï¼ç¬¬${firstFruit + 1}å¤©å‡ºç°äº†ç¬¬ä¸€é¢—ç•ªèŒ„ ğŸ…`
                });
            }

            // å¹³å‡ç”Ÿé•¿é€Ÿåº¦
            const totalGrowth = records[records.length - 1].height - records[0].height;
            const avgGrowth = (totalGrowth / records.length).toFixed(2);
            insights.push({
                emoji: 'ğŸ“Š',
                text: `ä½ çš„ç•ªèŒ„å¹³å‡æ¯å¤©é•¿é«˜${avgGrowth}cm`
            });

            const html = insights.map(i => `
                <div class="insight-card">
                    <div class="insight-emoji">${i.emoji}</div>
                    <div class="insight-text">${i.text}</div>
                </div>
            `).join('');
            document.getElementById('insightsList').innerHTML = html;
        }

        function fillHistoryTable(records) {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = records.map((r, i) => {
                const growth = i > 0 ? r.height - records[i - 1].height : 0;
                const growthClass = growth > 0 ? 'growth-positive' : growth < 0 ? 'growth-negative' : '';
                const growthText = growth > 0 ? `+${growth}cm` : growth < 0 ? `${growth}cm` : '-';
                
                return `
                    <tr>
                        <td>${r.date}</td>
                        <td>ç¬¬${i + 1}å¤©</td>
                        <td><strong>${r.height}cm</strong></td>
                        <td>${r.leaves}</td>
                        <td>${r.flowers}</td>
                        <td>${r.fruits}</td>
                        <td class="${growthClass}">${growthText}</td>
                    </tr>
                `;
            }).join('');
        }

        // ===== æ•™å¸ˆå…¨æ™¯ç›‘æ§ =====
        function loadTeacherMonitor() {
            const students = appData.students.map(student => {
                const lastRecord = student.records[student.records.length - 1];
                const daysSinceLastUpdate = lastRecord 
                    ? Math.ceil((new Date() - new Date(lastRecord.date)) / (1000 * 60 * 60 * 24))
                    : 999;

                // æ£€æŸ¥æ•°æ®å¼‚å¸¸
                let hasError = false;
                if (student.records.length >= 2) {
                    const lastTwo = student.records.slice(-2);
                    if (lastTwo[1].height < lastTwo[0].height - 5) {
                        hasError = true;
                    }
                }

                let status = 'normal';
                if (hasError) status = 'error';
                else if (daysSinceLastUpdate > 3) status = 'warning';

                return { ...student, status, daysSinceLastUpdate, lastRecord };
            });

            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('monitorTotal').textContent = students.length;
            document.getElementById('monitorActive').textContent = students.filter(s => s.status === 'normal').length;
            document.getElementById('monitorWarning').textContent = students.filter(s => s.status === 'warning').length;
            document.getElementById('monitorError').textContent = students.filter(s => s.status === 'error').length;
            
            const avgHeight = students.reduce((sum, s) => sum + (s.lastRecord?.height || 0), 0) / students.length;
            document.getElementById('monitorAvgHeight').textContent = avgHeight.toFixed(1);

            // æ¸²æŸ“å­¦ç”Ÿåˆ—è¡¨
            const listHtml = students.map(s => {
                const statusText = s.status === 'error' ? 'æ•°æ®å¼‚å¸¸' : s.status === 'warning' ? `${s.daysSinceLastUpdate}å¤©æœªæ›´æ–°` : 'æ­£å¸¸è®°å½•';
                return `
                    <div class="student-list-item ${appData.selectedStudentId === s.id ? 'selected' : ''}" onclick="selectStudent(${s.id})">
                        <div class="student-info">
                            <div class="status-indicator ${s.status}"></div>
                            <span style="font-size: 24px;">${s.avatar}</span>
                            <div>
                                <div style="font-weight: bold;">${s.name}</div>
                                <div style="font-size: 12px; color: #666;">${statusText}</div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold;">${s.lastRecord?.height || 0}cm</div>
                            <div style="font-size: 12px; color: #666;">${s.records.length}æ¡è®°å½•</div>
                        </div>
                        ${s.status === 'warning' ? `<button class="btn btn-small" style="background: #FEF3C7; margin-left: 12px;" onclick="event.stopPropagation(); remindStudent(${s.id})">ğŸ””</button>` : ''}
                    </div>
                `;
            }).join('');
            document.getElementById('monitorStudentList').innerHTML = listHtml;
        }

        function selectStudent(studentId) {
            appData.selectedStudentId = studentId;
            loadTeacherMonitor();

            const student = appData.students.find(s => s.id === studentId);
            if (!student) return;

            const days = getDaysSincePlanting(student.plantingDate);
            const lastRecord = student.records[student.records.length - 1] || {};

            const html = `
                <h2 style="font-size: 24px; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 32px;">${student.avatar}</span>
                    ${student.name}çš„æ¡£æ¡ˆ
                </h2>

                <div class="detail-section">
                    <div class="detail-row"><span>å®šæ¤æ—¥æœŸï¼š</span><strong>${student.plantingDate}</strong></div>
                    <div class="detail-row"><span>ç§æ¤å¤©æ•°ï¼š</span><strong>${days}å¤©</strong></div>
                    <div class="detail-row"><span>ç­‰çº§ï¼š</span><strong>Lv.${student.level}</strong></div>
                    <div class="detail-row"><span>è®°å½•æ¬¡æ•°ï¼š</span><strong>${student.records.length}æ¬¡</strong></div>
                </div>

                <div style="background: linear-gradient(135deg, #D1FAE5, #A7F3D0); border-radius: 12px; padding: 16px; margin-bottom: 24px;">
                    <h3 style="margin-bottom: 12px;">å½“å‰æ•°æ®</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <div style="text-align: center;"><div style="font-size: 24px;">ğŸ“</div><strong>${lastRecord.height || 0}cm</strong><div style="font-size: 12px; color: #666;">æ ªé«˜</div></div>
                        <div style="text-align: center;"><div style="font-size: 24px;">ğŸƒ</div><strong>${lastRecord.leaves || 0}</strong><div style="font-size: 12px; color: #666;">å¶ç‰‡</div></div>
                        <div style="text-align: center;"><div style="font-size: 24px;">ğŸŒ¸</div><strong>${lastRecord.flowers || 0}</strong><div style="font-size: 12px; color: #666;">èŠ±æœµ</div></div>
                        <div style="text-align: center;"><div style="font-size: 24px;">ğŸ…</div><strong>${lastRecord.fruits || 0}</strong><div style="font-size: 12px; color: #666;">æœå®</div></div>
                    </div>
                </div>

                ${student.badges && student.badges.length > 0 ? `
                    <div style="margin-bottom: 24px;">
                        <h3 style="margin-bottom: 12px;">è·å¾—çš„å‹‹ç« </h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${student.badges.map(b => `<span class="badge-item">ğŸ† ${b}</span>`).join('')}
                        </div>
                    </div>
                ` : ''}

                <button class="btn btn-secondary" style="width: 100%; margin-bottom: 12px;" onclick="exportStudentReport(${student.id})">
                    ğŸ“¥ å¯¼å‡ºç”µå­æ¡£æ¡ˆè¢‹
                </button>
            `;
            document.getElementById('studentDetailContent').innerHTML = html;
        }

        function remindStudent(studentId) {
            const student = appData.students.find(s => s.id === studentId);
            alert(`âœ‰ï¸ å·²å‘${student.name}å‘é€æé†’ï¼\n\n"å—¨${student.name}ï¼Œè®°å¾—ç»™ä½ çš„ç•ªèŒ„è®°å½•æ•°æ®å“¦ï¼"`);
        }

        function exportStudentReport(studentId) {
            const student = appData.students.find(s => s.id === studentId);
            const report = {
                studentName: student.name,
                plantingDate: student.plantingDate,
                totalDays: getDaysSincePlanting(student.plantingDate),
                records: student.records,
                badges: student.badges
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${student.name}_ç•ªèŒ„è§‚å¯Ÿæ—¥è®°_æŠ¥å‘Š.json`;
            a.click();
            
            alert(`ğŸ“„ ${student.name}çš„ç”µå­æ¡£æ¡ˆè¢‹å·²ç”Ÿæˆï¼`);
        }

        // å¤„ç†ç…§ç‰‡é€‰æ‹©
        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                appData.currentPhoto = e.target.result;
                document.getElementById('photoPreview').innerHTML = `
                    <img src="${e.target.result}" style="max-width: 100%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                `;
            };
            reader.readAsDataURL(file);
        }

        // ä¿å­˜ç…§ç‰‡å‘å¸ƒ
        function savePhotoPost(e) {
            e.preventDefault();
            
            if (!appData.currentPhoto) {
                alert('è¯·å…ˆæ‹ç…§ï¼');
                return;
            }

            const note = document.getElementById('noteInput').value;
            
            const newPhoto = {
                id: Date.now(),
                studentId: appData.currentUser.id,
                photo: appData.currentPhoto,
                note: note,
                timestamp: Date.now(),
                likes: 0,
                likedBy: []
            };

            appData.photos.unshift(newPhoto);
            saveToLocalStorage();

            alert('âœ… å‘å¸ƒæˆåŠŸï¼');
            
            // é‡ç½®è¡¨å•
            document.getElementById('noteInput').value = '';
            document.getElementById('photoPreview').innerHTML = '';
            appData.currentPhoto = null;
            document.getElementById('photoInput').value = '';
            
            showPage('my-photos');
        }

        // åŠ è½½æˆ‘çš„ç…§ç‰‡
        function loadMyPhotos() {
            const myPhotos = appData.photos.filter(p => p.studentId === appData.currentUser.id);
            const container = document.getElementById('myPhotosList');
            
            if (myPhotos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“·</div>
                        <p>è¿˜æ²¡æœ‰ç…§ç‰‡è®°å½•</p>
                        <button class="btn btn-primary" onclick="showPage('photo-capture')" style="margin-top: 16px;">
                            ç«‹å³æ‹ç…§
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = myPhotos.map(photo => createPhotoCard(photo, true)).join('');
        }

        // åŠ è½½ç­çº§ç…§ç‰‡å¢™
        function loadClassWall() {
            const container = document.getElementById('classPhotosList');
            container.innerHTML = appData.photos.map(photo => createPhotoCard(photo, false)).join('');
        }

        // åˆ›å»ºç…§ç‰‡å¡ç‰‡
        function createPhotoCard(photo, isOwner) {
            const student = appData.students.find(s => s.id === photo.studentId);
            const isLiked = photo.likedBy?.includes(appData.currentUser.id);
            const comments = appData.comments?.filter(c => c.photoId === photo.id) || [];
            const teacherComment = comments.find(c => c.isTeacher);

            return `
                <div class="photo-card">
                    <div class="photo-card-header">
                        <div class="avatar">${student.avatar}</div>
                        <div class="user-info">
                            <div class="user-name">${student.name}</div>
                            <div class="post-time">${formatTime(photo.timestamp)}</div>
                        </div>
                    </div>
                    
                    <img src="${photo.photo}" class="photo-card-image" onclick="openLightbox('${photo.photo}')">
                    
                    <div class="photo-card-content">
                        <div class="photo-description">${photo.note}</div>
                        
                        <div class="photo-meta">
                            <span>â¤ï¸ ${photo.likes} ä¸ªèµ</span>
                            <span>ğŸ’¬ ${comments.length} æ¡è¯„è®º</span>
                        </div>

                        <div class="photo-actions">
                            <button class="action-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike(${photo.id})">
                                â¤ï¸ ${isLiked ? 'å·²èµ' : 'ç‚¹èµ'}
                            </button>
                            <button class="action-btn" onclick="toggleComments(${photo.id})">
                                ğŸ’¬ è¯„è®º
                            </button>
                        </div>
                    </div>

                    ${teacherComment ? `
                        <div class="teacher-comment">
                            <div class="teacher-comment-header">
                                <span class="teacher-badge">æ•™å¸ˆè¯„è¯­</span>
                                <span style="font-size: 14px; color: #92400E;">${formatTime(teacherComment.timestamp)}</span>
                            </div>
                            <div class="teacher-comment-text">${teacherComment.text}</div>
                        </div>
                    ` : ''}

                    <div class="comments-section" id="comments-${photo.id}" style="display: none;">
                        <div id="comment-list-${photo.id}">
                            ${comments.filter(c => !c.isTeacher).map(c => createCommentHTML(c)).join('')}
                        </div>
                        <div class="comment-input-area">
                            <input type="text" class="comment-input" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." id="comment-input-${photo.id}">
                            <button class="btn btn-small btn-primary" onclick="postComment(${photo.id})">å‘é€</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // åˆ›å»ºè¯„è®ºHTML
        function createCommentHTML(comment) {
            const user = comment.isTeacher ? 
                appData.currentUser : 
                appData.students.find(s => s.id === comment.userId);
            
            return `
                <div class="comment">
                    <div class="comment-header">
                        <div class="comment-avatar">${user.avatar}</div>
                        <div class="comment-name">${user.name}</div>
                        <div class="comment-time">${formatTime(comment.timestamp)}</div>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                </div>
            `;
        }

        // åˆ‡æ¢ç‚¹èµ
        function toggleLike(photoId) {
            const photo = appData.photos.find(p => p.id === photoId);
            if (!photo.likedBy) photo.likedBy = [];
            
            const index = photo.likedBy.indexOf(appData.currentUser.id);
            if (index > -1) {
                photo.likedBy.splice(index, 1);
                photo.likes--;
            } else {
                photo.likedBy.push(appData.currentUser.id);
                photo.likes++;
            }
            
            saveToLocalStorage();
            loadClassWall();
            loadMyPhotos();
        }

        // åˆ‡æ¢è¯„è®ºåŒº
        function toggleComments(photoId) {
            const section = document.getElementById(`comments-${photoId}`);
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        // å‘å¸ƒè¯„è®º
        function postComment(photoId) {
            const input = document.getElementById(`comment-input-${photoId}`);
            const text = input.value.trim();
            
            if (!text) return;

            if (!appData.comments) appData.comments = [];
            
            appData.comments.push({
                id: Date.now(),
                photoId: photoId,
                userId: appData.currentUser.id,
                text: text,
                timestamp: Date.now(),
                isTeacher: appData.currentUser.role === 'teacher'
            });

            saveToLocalStorage();
            input.value = '';
            
            // é‡æ–°åŠ è½½å½“å‰é¡µé¢
            if (document.getElementById('class-wall').classList.contains('active')) {
                loadClassWall();
            } else {
                loadMyPhotos();
            }
        }

        // åŠ è½½è®¨è®ºåŒº
        function loadDiscussion() {
            const container = document.getElementById('discussionList');
            const photosWithComments = appData.photos.filter(p => {
                const comments = appData.comments?.filter(c => c.photoId === p.id) || [];
                return comments.length > 0;
            });

            if (photosWithComments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ’¬</div>
                        <p>è¿˜æ²¡æœ‰è®¨è®º</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = photosWithComments.map(photo => createPhotoCard(photo, false)).join('');
        }

        // æ•™å¸ˆç«¯
        function loadTeacherPanel() {
            document.getElementById('teacherTotalPhotos').textContent = appData.photos.length;
            
            const activeStudents = new Set(appData.photos.map(p => p.studentId)).size;
            document.getElementById('teacherActiveStudents').textContent = activeStudents;
            
            document.getElementById('teacherTotalComments').textContent = appData.comments?.length || 0;

            const container = document.getElementById('teacherPhotosList');
            container.innerHTML = appData.photos.map(photo => {
                const student = appData.students.find(s => s.id === photo.studentId);
                return `
                    <div class="card" style="margin-bottom: 16px;">
                        <div style="display: flex; gap: 16px; align-items: center;">
                            <img src="${photo.photo}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 12px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; margin-bottom: 4px;">${student.name} - ${formatTime(photo.timestamp)}</div>
                                <div style="font-size: 14px; color: #666; margin-bottom: 8px;">${photo.note.substring(0, 50)}...</div>
                                <button class="btn btn-small btn-secondary" onclick="writeTeacherComment(${photo.id})">
                                    âœï¸ å†™è¯„è¯­
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ•™å¸ˆå†™è¯„è¯­
        function writeTeacherComment(photoId) {
            const comment = prompt('è¯·è¾“å…¥è¯„è¯­ï¼š');
            if (!comment) return;

            if (!appData.comments) appData.comments = [];
            
            appData.comments.push({
                id: Date.now(),
                photoId: photoId,
                userId: appData.currentUser.id,
                text: comment,
                timestamp: Date.now(),
                isTeacher: true
            });

            saveToLocalStorage();
            alert('âœ… è¯„è¯­å·²å‘å¸ƒï¼');
            loadTeacherPanel();
        }

        // å¯¼å‡ºæ‰€æœ‰æ•°æ®
        function exportAllData() {
            let exportText = 'ç•ªèŒ„ç‹å›½ - å®Œæ•´è®°å½•å¯¼å‡º\n';
            exportText += '================================\n\n';
            
            appData.students.forEach(student => {
                const photos = appData.photos.filter(p => p.studentId === student.id);
                if (photos.length === 0) return;

                exportText += `\nã€${student.name}ã€‘çš„è®°å½•\n`;
                exportText += `æ€»ç…§ç‰‡æ•°ï¼š${photos.length}\n\n`;

                photos.forEach((photo, index) => {
                    exportText += `ç¬¬${index + 1}å¼ ç…§ç‰‡ï¼ˆ${formatTime(photo.timestamp)}ï¼‰\n`;
                    exportText += `è§‚å¯Ÿç¬”è®°ï¼š${photo.note}\n`;
                    exportText += `ç‚¹èµæ•°ï¼š${photo.likes}\n`;
                    
                    const comments = appData.comments?.filter(c => c.photoId === photo.id) || [];
                    if (comments.length > 0) {
                        exportText += `è¯„è®ºï¼š\n`;
                        comments.forEach(c => {
                            const commenter = c.isTeacher ? 'æ•™å¸ˆ' : appData.students.find(s => s.id === c.userId).name;
                            exportText += `  - ${commenter}ï¼š${c.text}\n`;
                        });
                    }
                    exportText += '\n';
                });

                exportText += '--------------------------------\n';
            });

            // ä¸‹è½½ä¸ºæ–‡æœ¬æ–‡ä»¶
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ç•ªèŒ„ç‹å›½è®°å½•_${new Date().toLocaleDateString()}.txt`;
            a.click();
            
            alert('âœ… å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¸‹è½½ã€‚');
        }

        // è¿‡æ»¤ç…§ç‰‡
        function filterPhotos(type) {
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            let filtered = [...appData.photos];
            if (type === 'recent') {
                filtered.sort((a, b) => b.timestamp - a.timestamp);
            } else if (type === 'popular') {
                filtered.sort((a, b) => b.likes - a.likes);
            }
            
            document.getElementById('classPhotosList').innerHTML = 
                filtered.map(photo => createPhotoCard(photo, false)).join('');
        }

        // ç¯ç®±
        function openLightbox(photoSrc) {
            document.getElementById('lightboxImage').src = photoSrc;
            document.getElementById('lightbox').classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        // åŠ è½½ç”Ÿé•¿æ—¶é—´è½´
        function loadTimeline() {
            const myPhotos = appData.photos.filter(p => p.studentId === appData.currentUser.id);
            const container = document.getElementById('timelineContent');
            
            if (myPhotos.length === 0) {
                container.innerHTML = `
                    <div class="timeline-line"></div>
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“…</div>
                        <p>è¿˜æ²¡æœ‰è®°å½•</p>
                        <button class="btn btn-primary" onclick="showPage('photo-capture')" style="margin-top: 16px;">
                            ç«‹å³æ‹ç…§
                        </button>
                    </div>
                `;
                return;
            }

            // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°åœ¨ä¸Šï¼‰
            const sortedPhotos = [...myPhotos].sort((a, b) => b.timestamp - a.timestamp);
            
            container.innerHTML = `
                <div class="timeline-line"></div>
                ${sortedPhotos.map((photo, index) => `
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">
                                ${new Date(photo.timestamp).toLocaleDateString('zh-CN', {year: 'numeric', month: 'long', day: 'numeric'})} 
                                (ç¬¬${myPhotos.length - index}å¤©)
                            </div>
                            <img src="${photo.photo}" class="timeline-photo" onclick="openLightbox('${photo.photo}')">
                            <div style="color: #666; margin-top: 12px; line-height: 1.6;">${photo.note}</div>
                            <div style="color: #999; font-size: 14px; margin-top: 8px;">
                                â¤ï¸ ${photo.likes} ä¸ªèµ Â· ğŸ’¬ ${(appData.comments?.filter(c => c.photoId === photo.id) || []).length} æ¡è¯„è®º
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        // ç”Ÿæˆç”µå­ä¹¦
        let ebookHTML = '';
        
        function generateEbook() {
            const myPhotos = appData.photos.filter(p => p.studentId === appData.currentUser.id);
            
            if (myPhotos.length === 0) {
                alert('è¿˜æ²¡æœ‰ç…§ç‰‡è®°å½•ï¼Œæ— æ³•ç”Ÿæˆç”µå­ä¹¦ï¼');
                return;
            }

            const student = appData.students.find(s => s.id === appData.currentUser.id);
            const sortedPhotos = [...myPhotos].sort((a, b) => a.timestamp - b.timestamp);
            
            // ç”Ÿæˆç”µå­ä¹¦HTML
            ebookHTML = `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${student.name}çš„ç•ªèŒ„æˆé•¿ç”µå­ä¹¦</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: #FEFBF5;
            padding: 20px;
            line-height: 1.8;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .cover {
            text-align: center;
            padding: 80px 40px;
            background: linear-gradient(135deg, #FF6347, #FFE4E1);
            border-radius: 16px;
            color: white;
            margin-bottom: 40px;
        }
        .cover h1 { font-size: 48px; margin-bottom: 20px; }
        .cover p { font-size: 24px; opacity: 0.9; }
        .page {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            page-break-after: always;
        }
        .page-title {
            font-size: 24px;
            color: #FF6347;
            margin-bottom: 16px;
            border-bottom: 3px solid #FF6347;
            padding-bottom: 8px;
        }
        .page-date {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .page-photo {
            width: 100%;
            max-width: 600px;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .page-note {
            font-size: 18px;
            color: #333;
            line-height: 2;
            margin-top: 20px;
            padding: 20px;
            background: #FFF4E6;
            border-radius: 12px;
            border-left: 4px solid #FF6347;
        }
        .comments {
            margin-top: 24px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
        }
        .comment {
            margin: 12px 0;
            padding: 12px;
            background: white;
            border-radius: 8px;
        }
        .comment-author {
            font-weight: bold;
            color: #FF6347;
            margin-bottom: 4px;
        }
        .teacher-comment {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-left: 4px solid #F59E0B;
            padding: 16px;
            margin-top: 20px;
            border-radius: 8px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 16px;
            color: #666;
        }
        @media print {
            body { background: white; }
            .page { page-break-after: always; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="cover">
            <h1>ğŸ… æˆ‘çš„ç•ªèŒ„æˆé•¿ç”µå­ä¹¦</h1>
            <p>${student.name} çš„è‡ªç„¶è§‚å¯Ÿç¬”è®°</p>
            <p style="font-size: 18px; margin-top: 20px;">
                ${new Date(sortedPhotos[0].timestamp).toLocaleDateString('zh-CN')} - 
                ${new Date(sortedPhotos[sortedPhotos.length-1].timestamp).toLocaleDateString('zh-CN')}
            </p>
            <p style="font-size: 16px; margin-top: 10px;">å…± ${sortedPhotos.length} å¤©çš„è§‚å¯Ÿè®°å½•</p>
        </div>

        ${sortedPhotos.map((photo, index) => {
            const comments = appData.comments?.filter(c => c.photoId === photo.id) || [];
            const teacherComment = comments.find(c => c.isTeacher);
            const studentComments = comments.filter(c => !c.isTeacher);
            
            return `
        <div class="page">
            <div class="page-title">ç¬¬ ${index + 1} å¤©çš„è§‚å¯Ÿ</div>
            <div class="page-date">ğŸ“… ${new Date(photo.timestamp).toLocaleDateString('zh-CN', {year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'})}</div>
            
            <img src="${photo.photo}" class="page-photo" alt="ç¬¬${index+1}å¤©çš„ç•ªèŒ„">
            
            <div class="page-note">
                <strong>ğŸ“ è§‚å¯Ÿç¬”è®°ï¼š</strong><br>
                ${photo.note}
            </div>

            <div class="stats">
                <span>â¤ï¸ ${photo.likes} ä¸ªèµ</span>
                <span>ğŸ’¬ ${comments.length} æ¡è¯„è®º</span>
            </div>

            ${teacherComment ? `
                <div class="teacher-comment">
                    <div style="font-weight: bold; color: #92400E; margin-bottom: 8px;">
                        ğŸ‘¨â€ğŸ« æ•™å¸ˆè¯„è¯­ï¼š
                    </div>
                    ${teacherComment.text}
                </div>
            ` : ''}

            ${studentComments.length > 0 ? `
                <div class="comments">
                    <strong>ğŸ’¬ åŒå­¦è¯„è®ºï¼š</strong>
                    ${studentComments.map(c => {
                        const commenter = appData.students.find(s => s.id === c.userId);
                        return `
                        <div class="comment">
                            <div class="comment-author">${commenter?.name || 'å­¦ç”Ÿ'}:</div>
                            ${c.text}
                        </div>
                        `;
                    }).join('')}
                </div>
            ` : ''}
        </div>
            `;
        }).join('')}

        <div class="page" style="text-align: center; padding: 60px 40px;">
            <h2 style="color: #FF6347; font-size: 36px; margin-bottom: 20px;">ğŸ‰ æˆé•¿æ€»ç»“</h2>
            <p style="font-size: 20px; color: #666; line-height: 2;">
                åœ¨è¿™ ${sortedPhotos.length} å¤©çš„æ—¶é—´é‡Œï¼Œ<br>
                æˆ‘ä»¬ä¸€èµ·è§è¯äº†ç•ªèŒ„çš„æˆé•¿ã€‚<br><br>
                æ¯ä¸€å¤©çš„è§‚å¯Ÿå’Œè®°å½•ï¼Œ<br>
                éƒ½æ˜¯çè´µçš„å­¦ä¹ ç»å†ã€‚<br><br>
                æ„Ÿè°¢ä½ çš„åšæŒå’Œä»˜å‡ºï¼ğŸŒ±
            </p>
            <p style="margin-top: 40px; color: #999;">
                ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}
            </p>
        </div>
    </div>
</body>
</html>
            `;

            // æ˜¾ç¤ºé¢„è§ˆ
            document.getElementById('ebookPreview').innerHTML = `
                <div class="ebook-preview">
                    <div class="ebook-cover">
                        <h1 style="font-size: 36px; margin-bottom: 16px;">ğŸ… æˆ‘çš„ç•ªèŒ„æˆé•¿ç”µå­ä¹¦</h1>
                        <p style="font-size: 20px;">${student.name} çš„è‡ªç„¶è§‚å¯Ÿç¬”è®°</p>
                        <p style="margin-top: 16px; opacity: 0.9;">å…± ${sortedPhotos.length} å¤©çš„è§‚å¯Ÿè®°å½•</p>
                    </div>
                    <div style="text-align: center; padding: 24px; background: #E0F2FE; border-radius: 12px;">
                        <p style="font-size: 18px; color: #0369a1; margin-bottom: 12px;">âœ… ç”µå­ä¹¦å·²ç”Ÿæˆï¼</p>
                        <p style="color: #666;">ç‚¹å‡»ä¸Šæ–¹â€œä¸‹è½½ç”µå­ä¹¦â€æŒ‰é’®ä¿å­˜ä¸ºHTMLæ–‡ä»¶</p>
                    </div>
                </div>
            `;
            
            document.getElementById('downloadEbookBtn').style.display = 'inline-block'ï¼› 

è¿™æ®µ JavaScript ä»£ç çš„ä½œç”¨æ˜¯å°† id ä¸º "downloadEbookBtn" çš„å…ƒç´ çš„æ˜¾ç¤ºæ ·å¼è®¾ç½®ä¸º "document.getElementById('downloadEbookBtn').style.display = 'inline-block';
            alert('âœ… ç”µå­ä¹¦ç”ŸæˆæˆåŠŸï¼ç‚¹å‡»ä¸‹è½½æŒ‰é’®ä¿å­˜ã€‚');
        }

        // ä¸‹è½½ç”µå­ä¹¦
        function downloadEbook() {  å‡½æ•° downloadEbook() {function downloadEbook() {
            if (!ebookHTML) {
                alert('è¯·å…ˆç”Ÿæˆç”µå­ä¹¦ï¼');
                return;
            }

            const student = appData.students.find(s => s.id === appData.currentUser.id);
            const blob = new Blob([ebookHTML], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${student.name}çš„ç•ªèŒ„æˆé•¿ç”µå­ä¹¦_${new Date().toLocaleDateString('zh-CN')}.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… ç”µå­ä¹¦å·²ä¸‹è½½ï¼åŒå‡»æ‰“å¼€HTMLæ–‡ä»¶å³å¯æŸ¥çœ‹ã€‚');
        }

        // å·¥å…·å‡½æ•°
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            if (diff < 604800000) return Math.floor(diff / 86400000) + 'å¤©å‰';
            
            return date.toLocaleDateString('zh-CN');
        }

        // åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
